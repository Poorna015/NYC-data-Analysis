install.packages("ggthemes")
library(ggthemes)

install.packages("ggrepel")
library(ggrepel)
install.packages("tidygraph")
library(tidygraph)
install.packages("ggraph")
library(ggraph)
install.packages("igraph")

library(igraph)

install.packages("caTools")
library(caTools)
install.packages("caret")
library(caret)
install.packages("data.table")
library(data.table)
install.packages("knitr")
library(knitr)
install.packages("cowplot")
library(cowplot)
require(ggplot2)
install.packages("ggmap", dependencies = T)
install.packages("devtools", dependencies = T)
library(devtools)
##'digest', 'scales', 'dplyr'
install_github("dkahle/ggmap")
require(ggmap)
install.packages("https://github.com/gagolews/stringi/raw/master/devel/winbuilder/3.5/stringi_1.2.4.zip",repos = NULL)
require(stringi)
require(ggmap)
library(dplyr)
library(reshape2)
library(zoo)
library(scales)
install.packages("extrafont")
library(extrafont)
library(grid)
install.packages("gridExtra")
library("gridExtra")
install.packages("rgdal")
library(rgdal)
install.packages("maptools")
library(maptools)
install.packages("maps")
library(maps)
install.packages("mapdata")
library(mapdata)
install.packages("mapview")
library(mapview)
install.packages("leaflet")
library(leaflet)
install.packages("taRifx")
library(taRifx)
install.packages("GGally")
library(GGally)
gpclibPermit()
source("helpers.R")
install.packages("lubridate", dependencies = T)
library(lubridate)
install.packages("parallel", dependencies = T)
library (parallel)
#parallel for Marcov Chain Monte Carlo. 
install.packages("tidyverse")
library(tidyverse)
install.packages("sf")
library(sf)
install.packages("chron")
library(chron)

NYC_18_06 <- read.csv(choose.files(), header = T)
NYC_18_05 <- read.csv(choose.files(), header = T)
NYC_18_04 <- read.csv(choose.files(), header = T)

head(NYC_18_06)
summary(NYC_18_06) 
summary(NYC_18_05)
summary(NYC_18_04) 

#The summary shows that there were first 2 Vendor in 2018-05 & 2018-04 it is only in 2018-06
#we see 4 vendor providers in the city. but on an average only 2 Vendors are used in the City.
#Hence in order to contain the Data Dimension and keep the data consistency while modeling we will 
#be using only Top 2 vendors in 2018-06 

#Selection of Vendor in 2018-06

qplot(NYC_18_06$VendorID, geom = "histogram") + ggtitle("Vendor Distribution") + xlab ("Vendor ID") + ylab ("Count")
qplot(NYC_18_05$VendorID, geom = "histogram") + ggtitle("Vendor Distribution") + xlab ("Vendor ID") + ylab ("Count")


#We see that most rides are carried out by vendor 1 and 2 hence we are going to take out vendor 3 & 4.

NYC_18_06<- subset(NYC_18_06, NYC_18_06$VendorID == "1" | NYC_18_06$VendorID == "2") 
NYC_18_05<- subset(NYC_18_05, NYC_18_05$VendorID == "1" | NYC_18_05$VendorID == "2") 

#Taking out Outliers, we propose to take out rows which will logically not support our model. 
#For example we will be taking out negative fare_amount, extra, mta_tax, tip_amount & tolls_amount. 

NYC_18_06_f<- subset(NYC_18_06, NYC_18_06$fare_amount >= 0 & NYC_18_06$extra >= 0 & NYC_18_06$mta_tax >= 0 & NYC_18_06$tip_amount >= 0 & NYC_18_06$tolls_amount >= 0 & NYC_18_06$improvement_surcharge >= 0 & NYC_18_06$total_amount >= 0)   
NYC_18_05_f<- subset(NYC_18_05, NYC_18_05$fare_amount >= 0 & NYC_18_05$extra >= 0 & NYC_18_05$mta_tax >= 0 & NYC_18_05$tip_amount >= 0 & NYC_18_05$tolls_amount >= 0 & NYC_18_05$improvement_surcharge >= 0 & NYC_18_05$total_amount >= 0)   
NYC_18_04_f<- subset(NYC_18_04, NYC_18_04$fare_amount >= 0 & NYC_18_04$extra >= 0 & NYC_18_04$mta_tax >= 0 & NYC_18_04$tip_amount >= 0 & NYC_18_04$tolls_amount >= 0 & NYC_18_04$improvement_surcharge >= 0 & NYC_18_04$total_amount >= 0)   

summary(NYC_18_06_f)
summary(NYC_18_05_f)
summary(NYC_18_04_f)

rm(NYC_18_04, NYC_18_05, NYC_18_06)

#Having addressed all the anomalies and taking out observations which will knew our data we will go ahead and 
#transform variables which will help us subset them and sample appropriately. 

NYC_18_06_f$DayPU <-weekdays(as.POSIXct(NYC_18_06_f$tpep_pickup_datetime), abbreviate = T)
NYC_18_06_f$DayDO <-weekdays(as.POSIXct(NYC_18_06_f$tpep_dropoff_datetime), abbreviate = T)


NYC_18_05_f$DayPU <-weekdays(as.POSIXct(NYC_18_05_f$tpep_pickup_datetime), abbreviate = T)
NYC_18_05_f$DayDO <-weekdays(as.POSIXct(NYC_18_05_f$tpep_dropoff_datetime), abbreviate = T)

NYC_18_04_f$DayPU <-weekdays(as.POSIXct(NYC_18_04_f$tpep_pickup_datetime), abbreviate = T)
NYC_18_04_f$DayDO <-weekdays(as.POSIXct(NYC_18_04_f$tpep_dropoff_datetime), abbreviate = T)

NYC_18_06_f$DayPU <- as.factor(NYC_18_06_f$DayPU)
NYC_18_06_f$DayDO <- as.factor(NYC_18_06_f$DayDO)

NYC_18_05_f$DayPU <- as.factor(NYC_18_05_f$DayPU)
NYC_18_05_f$DayDO <- as.factor(NYC_18_05_f$DayDO)

NYC_18_04_f$DayPU <- as.factor(NYC_18_04_f$DayPU)
NYC_18_04_f$DayDO <- as.factor(NYC_18_04_f$DayDO)

str(NYC_18_06_f)
str(NYC_18_05_f)
str(NYC_18_04_f)


#NYC_18_06_f <- select(NYC_18_06_f, -PULat)
#NYC_18_06_f <- select(NYC_18_06_f, -PULong)

#NYC_18_05_f <- select(NYC_18_05_f, -PULat)
#NYC_18_05_f <- select(NYC_18_05_f, -PULong)

#NYC_18_04_f <- select(NYC_18_04_f, -PULat)
#NYC_18_04_f <- select(NYC_18_04_f, -PULong)

#rm(Zone)

#In the 2018 dataset we dont not have Lat and longitudes of Taxi Zones. Hence we have imputed that lat and long from Google MAP and added it to the dataset. 
NYC_18_06_f$PULat<- sapply(NYC_18_06_f$PULocationID,switch,"1"=40.706268,"2"=40.603992,"3"=40.862305,"4"=40.725102,"5"=40.5568,"6"=40.60499758,"7"=40.7644,"8"=40.7792,"9"=40.7541,"10"=40.6738,"11"=40.6045,"12"=40.7033,"13"=40.7116,"14"=40.6262,"15"=40.7922,"16"=40.7586,"17"=40.6872,"18"=40.8701,"19"=40.732,"20"=40.8523,"21"=40.6113,"22"=40.603299,"23"=40.6073,"24"=40.7989,"25"=40.6849,"26"=40.6323,"27"=40.5867,"28"=40.7128,"29"=40.5781,"30"=40.6158,"31"=40.853829918,"32"=40.8506558,"33"=40.696,"34"=40.7020737,"35"=40.6631,"36"=40.6944,"37"=40.6944,"38"=40.6922,"39"=40.6402,"40"=40.6795,"41"=40.8116,"42"=40.8116,"43"=40.7829,"44"=40.5083,"45"=40.7158,"46"=40.8468,"47"=40.84,"48"=40.7638,"49"=40.6894,"50"=40.7638,"51"=40.8739,"52"=40.6865,"53"=40.7864,"54"=40.6874,"55"=40.5755,"56"=40.745,"57"=40.745,"58"=40.8392,"59"=40.84,"60"=40.84,"61"=40.6681,"62"=40.6681,"63"=40.6836,"64"=40.7687,"65"=40.696,"66"=40.7033,"67"=40.6215,"68"=40.7465,"69"=40.8284,"70"=40.7738,"71"=40.6437,"72"=40.6437,"73"=40.7526,"74"=40.8155,"75"=40.8116,"76"=40.6568,"77"=40.6568,"78"=40.8454,"79"=40.7265,"80"=40.7159,"81"=40.8833,"82"=40.738,"83"=40.7294,"84"=40.529,"85"=40.6493,"86"=40.5999,"87"=40.7075,"88"=40.7075,"89"=40.6409,"90"=40.7401,"91"=40.6268,"92"=40.7675,"93"=40.7397,"94"=40.8593,"95"=40.7181,"96"=40.6887278,"97"=40.6921,"98"=40.7335,"99"=40.5643,"100"=40.7547,"101"=40.7472,"102"=40.699,"103"=40.6895,"104"=40.6895,"105"=40.6895,"106"=40.6733,"107"=40.7368,"108"=40.591,"109"=40.5543,"110"=40.5488,"111"=40.6581,"112"=40.7245,"113"=40.7336,"114"=40.7336,"115"=40.6187,"116"=40.826,"117"=40.5927,"118"=40.6014,"119"=40.8385,"120"=40.8446,"121"=40.7336,"122"=40.7112,"123"=40.5999976,"124"=40.6571,"125"=40.7266,"126"=40.812,"127"=40.8677,"128"=40.8722,"129"=40.7557,"130"=40.7027,"131"=40.7179,"132"=40.6413,"133"=40.6376,"134"=40.7057,"135"=40.7385,"136"=40.872,"137"=40.7423,"138"=40.7769,"139"=40.6741,"140"=40.7662,"141"=40.7662,"142"=40.7738,"143"=40.7738,"144"=40.723,"145"=40.748,"146"=40.7489,"147"=40.8248,"148"=40.715,"149"=40.6056,"150"=40.5782,"151"=40.797,"152"=40.8169,"153"=40.8761,"154"=40.591,"155"=40.6101,"156"=40.6368,"157"=40.7294,"158"=40.7358,"159"=40.8245,"160"=40.7174,"161"=40.7549,"162"=40.754,"163"=40.765,"164"=40.7557,"165"=40.6191,"166"=40.809,"167"=40.8251,"168"=40.8091,"169"=40.8489,"170"=40.7479,"171"=40.7665,"172"=40.5715,"173"=40.7503,"174"=40.8771,"175"=40.7409,"176"=40.564,"177"=40.673830638,"178"=40.6169,"179"=40.7644,"180"=40.6794,"181"=40.6681,"182"=40.8383,"183"=40.8506,"184"=40.8655,"185"=40.8553,"186"=40.7428,"187"=40.6355,"188"=40.659,"189"=40.6774,"190"=40.6602,"191"=40.7157,"192"=40.7675,"193"=40.7567,"194"=40.7932,"195"=40.6773,"196"=40.7256,"197"=40.6958,"198"=40.7044,"199"=40.793128,"200"=40.8943,"201"=40.5798,"202"=40.7605,"203"=40.6584,"204"=40.5434,"205"=40.6894,"206"=40.6404,"207"=40.7647,"208"=40.8349,"209"=40.7071,"210"=40.5976,"211"=40.7233,"212"=40.8251,"213"=40.8177,"214"=40.5907,"215"=40.6809,"216"=40.6794,"217"=40.708497166,"218"=40.6626,"219"=40.6626,"220"=40.8812,"221"=40.6265,"222"=40.649,"223"=40.7745,"224"=40.7317,"225"=40.6824,"226"=40.7433,"227"=40.645531,"228"=40.645531,"229"=40.754,"230"=40.7589,"231"=40.7141,"232"=40.7149,"233"=40.7489,"234"=40.7359,"235"=40.8516,"236"=40.7736,"237"=40.7736,"238"=40.7736,"239"=40.7736,"240"=40.8963,"241"=40.884,"242"=40.8416,"243"=40.8417,"244"=40.8417,"245"=40.627,"246"=40.754661,"247"=40.8317,"248"=40.8431,"249"=40.7358,"250"=40.8275,"251"=40.6212,"252"=40.792,"253"=40.7607,"254"=40.8777,"255"=40.7081,"256"=40.7081,"257"=40.6539,"258"=40.6901,"259"=40.8965,"260"=40.7512,"261"=40.7118,"262"=40.7762,"263"=40.7762,"264"=0,"265"=0)
NYC_18_06_f$PULong<- sapply(NYC_18_06_f$PULocationID,switch,"1"=-74.176811,"2"=-73.835411,"3"=-73.84317,"4"=-73.979583,"5"=-74.1739,"6"=-74.05749977,"7"=-73.9235,"8"=-73.923,"9"=-73.786,"10"=-73.786,"11"=-74.0043,"12"=-74.017,"13"=-74.0158,"14"=-74.0329,"15"=-73.7761,"16"=-73.7654,"17"=-73.9418,"18"=-73.8857,"19"=-73.7184,"20"=-73.886,"21"=-73.9977,"22"=-74.001975,"23"=-74.0961,"24"=-73.9698,"25"=-73.9845,"26"=-73.9889,"27"=-73.8115,"28"=-73.7993,"29"=-73.9597,"30"=-73.8213,"31"=-73.872663176,"32"=-73.8665241,"33"=-73.9933,"34"=-73.9708292,"35"=-73.9095,"36"=-73.9213,"37"=-73.9213,"38"=-73.7331,"39"=-73.9061,"40"=-73.9992,"41"=-73.9465,"42"=-73.9465,"43"=-73.9654,"44"=-74.2355,"45"=-73.997,"46"=-73.7875,"47"=-73.9036,"48"=-73.9918,"49"=-73.9639,"50"=-73.9918,"51"=-73.8294,"52"=-73.9962,"53"=-73.839,"54"=-74.0021,"55"=-73.9707,"56"=-73.8643,"57"=-73.8643,"58"=-73.8197,"59"=-73.8953,"60"=-73.8953,"61"=-73.9448,"62"=-73.9448,"63"=-73.8801,"64"=-73.7471,"65"=-73.9845,"66"=-73.9881,"67"=-74.0096,"68"=-74.0014,"69"=-73.9169,"70"=-73.8713,"71"=-73.9301,"72"=-73.9301,"73"=-73.8096,"74"=-73.9556,"75"=-73.9465,"76"=-73.8831,"77"=-73.8831,"78"=-73.891,"79"=-73.9815,"80"=-73.933,"81"=-73.8272,"82"=-73.8801,"83"=-73.9066,"84"=-74.1976,"85"=-73.958,"86"=-73.7448,"87"=-74.0113,"88"=-74.0113,"89"=-73.9624,"90"=-73.9903,"91"=-73.933,"92"=-73.8331,"93"=-73.8408,"94"=-73.8985,"95"=-73.8448,"96"=-73.8862997,"97"=-73.9742,"98"=-73.7801,"99"=-74.1863,"100"=-73.9916,"101"=-73.7118,"102"=-73.8804,"103"=-74.0449,"104"=-74.0449,"105"=-74.0449,"106"=-73.9903,"107"=-73.9845,"108"=-73.9771,"109"=-74.1563,"110"=-74.1269,"111"=-73.9948,"112"=-73.9419,"113"=-74.0027,"114"=-74.0027,"115"=-74.0935,"116"=-73.9496,"117"=-73.7978,"118"=-74.1034,"119"=-73.9272,"120"=-73.933,"121"=-73.8124,"122"=-73.7625,"123"=-73.9499962,"124"=-73.843,"125"=-74.0075,"126"=-73.8801,"127"=-73.9212,"128"=-73.9256,"129"=-73.8831,"130"=-73.789,"131"=-73.7743,"132"=-73.7781,"133"=-73.9742,"134"=-73.8272,"135"=-73.8107,"136"=-73.902,"137"=-73.9801,"138"=-73.874,"139"=-73.7448,"140"=-73.9602,"141"=-73.9602,"142"=-73.9845,"143"=-73.9845,"144"=-73.9949,"145"=-73.9507,"146"=-73.9374,"147"=-73.8916,"148"=-73.9843,"149"=-73.9492,"150"=-73.9389,"151"=-73.9697,"152"=-73.9558,"153"=-73.9103,"154"=-73.8906,"155"=-73.911,"156"=-74.1588,"157"=-73.9066,"158"=-74.0036,"159"=-73.9104,"160"=-73.8743,"161"=-73.984,"162"=-73.9668,"163"=-73.9851,"164"=-73.9788,"165"=-73.9654,"166"=-73.9624,"167"=-73.911,"168"=-73.9229,"169"=-73.9051,"170"=-73.9757,"171"=-73.8037,"172"=-74.0932,"173"=-73.8625,"174"=-73.8787,"175"=-73.7582,"176"=-74.116,"177"=-73.904329716,"178"=-73.9691,"179"=-73.9235,"180"=-73.8507,"181"=-73.9806,"182"=-73.8566,"183"=-73.8333,"184"=-73.8092,"185"=-73.864,"186"=-73.9893,"187"=-74.1255,"188"=-73.9507,"189"=-73.9668,"190"=-73.969,"191"=-73.7419,"192"=-73.8331,"193"=-73.9484,"194"=-73.9213,"195"=-74.0094,"196"=-73.8625,"197"=-73.8272,"198"=-73.9018,"199"=-73.88601,"200"=-73.9036,"201"=-73.8372,"202"=-73.951,"203"=-73.739,"204"=-74.1976,"205"=-73.7654,"206"=-74.0902,"207"=-73.8985,"208"=-73.8331,"209"=-74.0035,"210"=-73.9536,"211"=-74.003,"212"=-73.8684,"213"=-73.8507,"214"=-74.0885,"215"=-73.7919,"216"=-73.8507,"217"=-73.951996192,"218"=-73.7684,"219"=-73.7684,"220"=-73.9154,"221"=-74.0776,"222"=-73.8802,"223"=-73.9037,"224"=-73.9778,"225"=-73.932,"226"=-73.9196,"227"=-74.012383,"228"=-74.012383,"229"=-73.9668,"230"=-73.9851,"231"=-74.0028,"232"=-73.9892,"233"=-73.968,"234"=-73.9911,"235"=-73.9154,"236"=-73.9566,"237"=-73.9566,"238"=-73.9566,"239"=-73.9566,"240"=-73.8877,"241"=-73.894,"242"=-73.8707,"243"=-73.9394,"244"=-73.9394,"245"=-74.1093,"246"=-74.003783,"247"=-73.9228,"248"=-73.8816,"249"=-74.0036,"250"=-73.8507,"251"=-74.1318,"252"=-73.8096,"253"=-73.8404,"254"=-73.8566,"255"=-73.9571,"256"=-73.9571,"257"=-73.9757,"258"=-73.8566,"259"=-73.8507,"260"=-73.9036,"261"=-74.0131,"262"=-73.9492,"263"=-73.9492,"264"=0,"265"=0)

NYC_18_06_f$DOLat<- sapply(NYC_18_06_f$DOLocationID,switch,"1"=40.706268,"2"=40.603992,"3"=40.862305,"4"=40.725102,"5"=40.5568,"6"=40.60499758,"7"=40.7644,"8"=40.7792,"9"=40.7541,"10"=40.6738,"11"=40.6045,"12"=40.7033,"13"=40.7116,"14"=40.6262,"15"=40.7922,"16"=40.7586,"17"=40.6872,"18"=40.8701,"19"=40.732,"20"=40.8523,"21"=40.6113,"22"=40.603299,"23"=40.6073,"24"=40.7989,"25"=40.6849,"26"=40.6323,"27"=40.5867,"28"=40.7128,"29"=40.5781,"30"=40.6158,"31"=40.853829918,"32"=40.8506558,"33"=40.696,"34"=40.7020737,"35"=40.6631,"36"=40.6944,"37"=40.6944,"38"=40.6922,"39"=40.6402,"40"=40.6795,"41"=40.8116,"42"=40.8116,"43"=40.7829,"44"=40.5083,"45"=40.7158,"46"=40.8468,"47"=40.84,"48"=40.7638,"49"=40.6894,"50"=40.7638,"51"=40.8739,"52"=40.6865,"53"=40.7864,"54"=40.6874,"55"=40.5755,"56"=40.745,"57"=40.745,"58"=40.8392,"59"=40.84,"60"=40.84,"61"=40.6681,"62"=40.6681,"63"=40.6836,"64"=40.7687,"65"=40.696,"66"=40.7033,"67"=40.6215,"68"=40.7465,"69"=40.8284,"70"=40.7738,"71"=40.6437,"72"=40.6437,"73"=40.7526,"74"=40.8155,"75"=40.8116,"76"=40.6568,"77"=40.6568,"78"=40.8454,"79"=40.7265,"80"=40.7159,"81"=40.8833,"82"=40.738,"83"=40.7294,"84"=40.529,"85"=40.6493,"86"=40.5999,"87"=40.7075,"88"=40.7075,"89"=40.6409,"90"=40.7401,"91"=40.6268,"92"=40.7675,"93"=40.7397,"94"=40.8593,"95"=40.7181,"96"=40.6887278,"97"=40.6921,"98"=40.7335,"99"=40.5643,"100"=40.7547,"101"=40.7472,"102"=40.699,"103"=40.6895,"104"=40.6895,"105"=40.6895,"106"=40.6733,"107"=40.7368,"108"=40.591,"109"=40.5543,"110"=40.5488,"111"=40.6581,"112"=40.7245,"113"=40.7336,"114"=40.7336,"115"=40.6187,"116"=40.826,"117"=40.5927,"118"=40.6014,"119"=40.8385,"120"=40.8446,"121"=40.7336,"122"=40.7112,"123"=40.5999976,"124"=40.6571,"125"=40.7266,"126"=40.812,"127"=40.8677,"128"=40.8722,"129"=40.7557,"130"=40.7027,"131"=40.7179,"132"=40.6413,"133"=40.6376,"134"=40.7057,"135"=40.7385,"136"=40.872,"137"=40.7423,"138"=40.7769,"139"=40.6741,"140"=40.7662,"141"=40.7662,"142"=40.7738,"143"=40.7738,"144"=40.723,"145"=40.748,"146"=40.7489,"147"=40.8248,"148"=40.715,"149"=40.6056,"150"=40.5782,"151"=40.797,"152"=40.8169,"153"=40.8761,"154"=40.591,"155"=40.6101,"156"=40.6368,"157"=40.7294,"158"=40.7358,"159"=40.8245,"160"=40.7174,"161"=40.7549,"162"=40.754,"163"=40.765,"164"=40.7557,"165"=40.6191,"166"=40.809,"167"=40.8251,"168"=40.8091,"169"=40.8489,"170"=40.7479,"171"=40.7665,"172"=40.5715,"173"=40.7503,"174"=40.8771,"175"=40.7409,"176"=40.564,"177"=40.673830638,"178"=40.6169,"179"=40.7644,"180"=40.6794,"181"=40.6681,"182"=40.8383,"183"=40.8506,"184"=40.8655,"185"=40.8553,"186"=40.7428,"187"=40.6355,"188"=40.659,"189"=40.6774,"190"=40.6602,"191"=40.7157,"192"=40.7675,"193"=40.7567,"194"=40.7932,"195"=40.6773,"196"=40.7256,"197"=40.6958,"198"=40.7044,"199"=40.793128,"200"=40.8943,"201"=40.5798,"202"=40.7605,"203"=40.6584,"204"=40.5434,"205"=40.6894,"206"=40.6404,"207"=40.7647,"208"=40.8349,"209"=40.7071,"210"=40.5976,"211"=40.7233,"212"=40.8251,"213"=40.8177,"214"=40.5907,"215"=40.6809,"216"=40.6794,"217"=40.708497166,"218"=40.6626,"219"=40.6626,"220"=40.8812,"221"=40.6265,"222"=40.649,"223"=40.7745,"224"=40.7317,"225"=40.6824,"226"=40.7433,"227"=40.645531,"228"=40.645531,"229"=40.754,"230"=40.7589,"231"=40.7141,"232"=40.7149,"233"=40.7489,"234"=40.7359,"235"=40.8516,"236"=40.7736,"237"=40.7736,"238"=40.7736,"239"=40.7736,"240"=40.8963,"241"=40.884,"242"=40.8416,"243"=40.8417,"244"=40.8417,"245"=40.627,"246"=40.754661,"247"=40.8317,"248"=40.8431,"249"=40.7358,"250"=40.8275,"251"=40.6212,"252"=40.792,"253"=40.7607,"254"=40.8777,"255"=40.7081,"256"=40.7081,"257"=40.6539,"258"=40.6901,"259"=40.8965,"260"=40.7512,"261"=40.7118,"262"=40.7762,"263"=40.7762,"264"=0,"265"=0)
NYC_18_06_f$DOLong<- sapply(NYC_18_06_f$DOLocationID,switch,"1"=-74.176811,"2"=-73.835411,"3"=-73.84317,"4"=-73.979583,"5"=-74.1739,"6"=-74.05749977,"7"=-73.9235,"8"=-73.923,"9"=-73.786,"10"=-73.786,"11"=-74.0043,"12"=-74.017,"13"=-74.0158,"14"=-74.0329,"15"=-73.7761,"16"=-73.7654,"17"=-73.9418,"18"=-73.8857,"19"=-73.7184,"20"=-73.886,"21"=-73.9977,"22"=-74.001975,"23"=-74.0961,"24"=-73.9698,"25"=-73.9845,"26"=-73.9889,"27"=-73.8115,"28"=-73.7993,"29"=-73.9597,"30"=-73.8213,"31"=-73.872663176,"32"=-73.8665241,"33"=-73.9933,"34"=-73.9708292,"35"=-73.9095,"36"=-73.9213,"37"=-73.9213,"38"=-73.7331,"39"=-73.9061,"40"=-73.9992,"41"=-73.9465,"42"=-73.9465,"43"=-73.9654,"44"=-74.2355,"45"=-73.997,"46"=-73.7875,"47"=-73.9036,"48"=-73.9918,"49"=-73.9639,"50"=-73.9918,"51"=-73.8294,"52"=-73.9962,"53"=-73.839,"54"=-74.0021,"55"=-73.9707,"56"=-73.8643,"57"=-73.8643,"58"=-73.8197,"59"=-73.8953,"60"=-73.8953,"61"=-73.9448,"62"=-73.9448,"63"=-73.8801,"64"=-73.7471,"65"=-73.9845,"66"=-73.9881,"67"=-74.0096,"68"=-74.0014,"69"=-73.9169,"70"=-73.8713,"71"=-73.9301,"72"=-73.9301,"73"=-73.8096,"74"=-73.9556,"75"=-73.9465,"76"=-73.8831,"77"=-73.8831,"78"=-73.891,"79"=-73.9815,"80"=-73.933,"81"=-73.8272,"82"=-73.8801,"83"=-73.9066,"84"=-74.1976,"85"=-73.958,"86"=-73.7448,"87"=-74.0113,"88"=-74.0113,"89"=-73.9624,"90"=-73.9903,"91"=-73.933,"92"=-73.8331,"93"=-73.8408,"94"=-73.8985,"95"=-73.8448,"96"=-73.8862997,"97"=-73.9742,"98"=-73.7801,"99"=-74.1863,"100"=-73.9916,"101"=-73.7118,"102"=-73.8804,"103"=-74.0449,"104"=-74.0449,"105"=-74.0449,"106"=-73.9903,"107"=-73.9845,"108"=-73.9771,"109"=-74.1563,"110"=-74.1269,"111"=-73.9948,"112"=-73.9419,"113"=-74.0027,"114"=-74.0027,"115"=-74.0935,"116"=-73.9496,"117"=-73.7978,"118"=-74.1034,"119"=-73.9272,"120"=-73.933,"121"=-73.8124,"122"=-73.7625,"123"=-73.9499962,"124"=-73.843,"125"=-74.0075,"126"=-73.8801,"127"=-73.9212,"128"=-73.9256,"129"=-73.8831,"130"=-73.789,"131"=-73.7743,"132"=-73.7781,"133"=-73.9742,"134"=-73.8272,"135"=-73.8107,"136"=-73.902,"137"=-73.9801,"138"=-73.874,"139"=-73.7448,"140"=-73.9602,"141"=-73.9602,"142"=-73.9845,"143"=-73.9845,"144"=-73.9949,"145"=-73.9507,"146"=-73.9374,"147"=-73.8916,"148"=-73.9843,"149"=-73.9492,"150"=-73.9389,"151"=-73.9697,"152"=-73.9558,"153"=-73.9103,"154"=-73.8906,"155"=-73.911,"156"=-74.1588,"157"=-73.9066,"158"=-74.0036,"159"=-73.9104,"160"=-73.8743,"161"=-73.984,"162"=-73.9668,"163"=-73.9851,"164"=-73.9788,"165"=-73.9654,"166"=-73.9624,"167"=-73.911,"168"=-73.9229,"169"=-73.9051,"170"=-73.9757,"171"=-73.8037,"172"=-74.0932,"173"=-73.8625,"174"=-73.8787,"175"=-73.7582,"176"=-74.116,"177"=-73.904329716,"178"=-73.9691,"179"=-73.9235,"180"=-73.8507,"181"=-73.9806,"182"=-73.8566,"183"=-73.8333,"184"=-73.8092,"185"=-73.864,"186"=-73.9893,"187"=-74.1255,"188"=-73.9507,"189"=-73.9668,"190"=-73.969,"191"=-73.7419,"192"=-73.8331,"193"=-73.9484,"194"=-73.9213,"195"=-74.0094,"196"=-73.8625,"197"=-73.8272,"198"=-73.9018,"199"=-73.88601,"200"=-73.9036,"201"=-73.8372,"202"=-73.951,"203"=-73.739,"204"=-74.1976,"205"=-73.7654,"206"=-74.0902,"207"=-73.8985,"208"=-73.8331,"209"=-74.0035,"210"=-73.9536,"211"=-74.003,"212"=-73.8684,"213"=-73.8507,"214"=-74.0885,"215"=-73.7919,"216"=-73.8507,"217"=-73.951996192,"218"=-73.7684,"219"=-73.7684,"220"=-73.9154,"221"=-74.0776,"222"=-73.8802,"223"=-73.9037,"224"=-73.9778,"225"=-73.932,"226"=-73.9196,"227"=-74.012383,"228"=-74.012383,"229"=-73.9668,"230"=-73.9851,"231"=-74.0028,"232"=-73.9892,"233"=-73.968,"234"=-73.9911,"235"=-73.9154,"236"=-73.9566,"237"=-73.9566,"238"=-73.9566,"239"=-73.9566,"240"=-73.8877,"241"=-73.894,"242"=-73.8707,"243"=-73.9394,"244"=-73.9394,"245"=-74.1093,"246"=-74.003783,"247"=-73.9228,"248"=-73.8816,"249"=-74.0036,"250"=-73.8507,"251"=-74.1318,"252"=-73.8096,"253"=-73.8404,"254"=-73.8566,"255"=-73.9571,"256"=-73.9571,"257"=-73.9757,"258"=-73.8566,"259"=-73.8507,"260"=-73.9036,"261"=-74.0131,"262"=-73.9492,"263"=-73.9492,"264"=0,"265"=0)

head(NYC_18_06_f)
NYC_18_05_f$PULat<- sapply(NYC_18_05_f$PULocationID,switch,"1"=40.706268,"2"=40.603992,"3"=40.862305,"4"=40.725102,"5"=40.5568,"6"=40.60499758,"7"=40.7644,"8"=40.7792,"9"=40.7541,"10"=40.6738,"11"=40.6045,"12"=40.7033,"13"=40.7116,"14"=40.6262,"15"=40.7922,"16"=40.7586,"17"=40.6872,"18"=40.8701,"19"=40.732,"20"=40.8523,"21"=40.6113,"22"=40.603299,"23"=40.6073,"24"=40.7989,"25"=40.6849,"26"=40.6323,"27"=40.5867,"28"=40.7128,"29"=40.5781,"30"=40.6158,"31"=40.853829918,"32"=40.8506558,"33"=40.696,"34"=40.7020737,"35"=40.6631,"36"=40.6944,"37"=40.6944,"38"=40.6922,"39"=40.6402,"40"=40.6795,"41"=40.8116,"42"=40.8116,"43"=40.7829,"44"=40.5083,"45"=40.7158,"46"=40.8468,"47"=40.84,"48"=40.7638,"49"=40.6894,"50"=40.7638,"51"=40.8739,"52"=40.6865,"53"=40.7864,"54"=40.6874,"55"=40.5755,"56"=40.745,"57"=40.745,"58"=40.8392,"59"=40.84,"60"=40.84,"61"=40.6681,"62"=40.6681,"63"=40.6836,"64"=40.7687,"65"=40.696,"66"=40.7033,"67"=40.6215,"68"=40.7465,"69"=40.8284,"70"=40.7738,"71"=40.6437,"72"=40.6437,"73"=40.7526,"74"=40.8155,"75"=40.8116,"76"=40.6568,"77"=40.6568,"78"=40.8454,"79"=40.7265,"80"=40.7159,"81"=40.8833,"82"=40.738,"83"=40.7294,"84"=40.529,"85"=40.6493,"86"=40.5999,"87"=40.7075,"88"=40.7075,"89"=40.6409,"90"=40.7401,"91"=40.6268,"92"=40.7675,"93"=40.7397,"94"=40.8593,"95"=40.7181,"96"=40.6887278,"97"=40.6921,"98"=40.7335,"99"=40.5643,"100"=40.7547,"101"=40.7472,"102"=40.699,"103"=40.6895,"104"=40.6895,"105"=40.6895,"106"=40.6733,"107"=40.7368,"108"=40.591,"109"=40.5543,"110"=40.5488,"111"=40.6581,"112"=40.7245,"113"=40.7336,"114"=40.7336,"115"=40.6187,"116"=40.826,"117"=40.5927,"118"=40.6014,"119"=40.8385,"120"=40.8446,"121"=40.7336,"122"=40.7112,"123"=40.5999976,"124"=40.6571,"125"=40.7266,"126"=40.812,"127"=40.8677,"128"=40.8722,"129"=40.7557,"130"=40.7027,"131"=40.7179,"132"=40.6413,"133"=40.6376,"134"=40.7057,"135"=40.7385,"136"=40.872,"137"=40.7423,"138"=40.7769,"139"=40.6741,"140"=40.7662,"141"=40.7662,"142"=40.7738,"143"=40.7738,"144"=40.723,"145"=40.748,"146"=40.7489,"147"=40.8248,"148"=40.715,"149"=40.6056,"150"=40.5782,"151"=40.797,"152"=40.8169,"153"=40.8761,"154"=40.591,"155"=40.6101,"156"=40.6368,"157"=40.7294,"158"=40.7358,"159"=40.8245,"160"=40.7174,"161"=40.7549,"162"=40.754,"163"=40.765,"164"=40.7557,"165"=40.6191,"166"=40.809,"167"=40.8251,"168"=40.8091,"169"=40.8489,"170"=40.7479,"171"=40.7665,"172"=40.5715,"173"=40.7503,"174"=40.8771,"175"=40.7409,"176"=40.564,"177"=40.673830638,"178"=40.6169,"179"=40.7644,"180"=40.6794,"181"=40.6681,"182"=40.8383,"183"=40.8506,"184"=40.8655,"185"=40.8553,"186"=40.7428,"187"=40.6355,"188"=40.659,"189"=40.6774,"190"=40.6602,"191"=40.7157,"192"=40.7675,"193"=40.7567,"194"=40.7932,"195"=40.6773,"196"=40.7256,"197"=40.6958,"198"=40.7044,"199"=40.793128,"200"=40.8943,"201"=40.5798,"202"=40.7605,"203"=40.6584,"204"=40.5434,"205"=40.6894,"206"=40.6404,"207"=40.7647,"208"=40.8349,"209"=40.7071,"210"=40.5976,"211"=40.7233,"212"=40.8251,"213"=40.8177,"214"=40.5907,"215"=40.6809,"216"=40.6794,"217"=40.708497166,"218"=40.6626,"219"=40.6626,"220"=40.8812,"221"=40.6265,"222"=40.649,"223"=40.7745,"224"=40.7317,"225"=40.6824,"226"=40.7433,"227"=40.645531,"228"=40.645531,"229"=40.754,"230"=40.7589,"231"=40.7141,"232"=40.7149,"233"=40.7489,"234"=40.7359,"235"=40.8516,"236"=40.7736,"237"=40.7736,"238"=40.7736,"239"=40.7736,"240"=40.8963,"241"=40.884,"242"=40.8416,"243"=40.8417,"244"=40.8417,"245"=40.627,"246"=40.754661,"247"=40.8317,"248"=40.8431,"249"=40.7358,"250"=40.8275,"251"=40.6212,"252"=40.792,"253"=40.7607,"254"=40.8777,"255"=40.7081,"256"=40.7081,"257"=40.6539,"258"=40.6901,"259"=40.8965,"260"=40.7512,"261"=40.7118,"262"=40.7762,"263"=40.7762,"264"=0,"265"=0)
NYC_18_05_f$PULong<- sapply(NYC_18_05_f$PULocationID,switch,"1"=-74.176811,"2"=-73.835411,"3"=-73.84317,"4"=-73.979583,"5"=-74.1739,"6"=-74.05749977,"7"=-73.9235,"8"=-73.923,"9"=-73.786,"10"=-73.786,"11"=-74.0043,"12"=-74.017,"13"=-74.0158,"14"=-74.0329,"15"=-73.7761,"16"=-73.7654,"17"=-73.9418,"18"=-73.8857,"19"=-73.7184,"20"=-73.886,"21"=-73.9977,"22"=-74.001975,"23"=-74.0961,"24"=-73.9698,"25"=-73.9845,"26"=-73.9889,"27"=-73.8115,"28"=-73.7993,"29"=-73.9597,"30"=-73.8213,"31"=-73.872663176,"32"=-73.8665241,"33"=-73.9933,"34"=-73.9708292,"35"=-73.9095,"36"=-73.9213,"37"=-73.9213,"38"=-73.7331,"39"=-73.9061,"40"=-73.9992,"41"=-73.9465,"42"=-73.9465,"43"=-73.9654,"44"=-74.2355,"45"=-73.997,"46"=-73.7875,"47"=-73.9036,"48"=-73.9918,"49"=-73.9639,"50"=-73.9918,"51"=-73.8294,"52"=-73.9962,"53"=-73.839,"54"=-74.0021,"55"=-73.9707,"56"=-73.8643,"57"=-73.8643,"58"=-73.8197,"59"=-73.8953,"60"=-73.8953,"61"=-73.9448,"62"=-73.9448,"63"=-73.8801,"64"=-73.7471,"65"=-73.9845,"66"=-73.9881,"67"=-74.0096,"68"=-74.0014,"69"=-73.9169,"70"=-73.8713,"71"=-73.9301,"72"=-73.9301,"73"=-73.8096,"74"=-73.9556,"75"=-73.9465,"76"=-73.8831,"77"=-73.8831,"78"=-73.891,"79"=-73.9815,"80"=-73.933,"81"=-73.8272,"82"=-73.8801,"83"=-73.9066,"84"=-74.1976,"85"=-73.958,"86"=-73.7448,"87"=-74.0113,"88"=-74.0113,"89"=-73.9624,"90"=-73.9903,"91"=-73.933,"92"=-73.8331,"93"=-73.8408,"94"=-73.8985,"95"=-73.8448,"96"=-73.8862997,"97"=-73.9742,"98"=-73.7801,"99"=-74.1863,"100"=-73.9916,"101"=-73.7118,"102"=-73.8804,"103"=-74.0449,"104"=-74.0449,"105"=-74.0449,"106"=-73.9903,"107"=-73.9845,"108"=-73.9771,"109"=-74.1563,"110"=-74.1269,"111"=-73.9948,"112"=-73.9419,"113"=-74.0027,"114"=-74.0027,"115"=-74.0935,"116"=-73.9496,"117"=-73.7978,"118"=-74.1034,"119"=-73.9272,"120"=-73.933,"121"=-73.8124,"122"=-73.7625,"123"=-73.9499962,"124"=-73.843,"125"=-74.0075,"126"=-73.8801,"127"=-73.9212,"128"=-73.9256,"129"=-73.8831,"130"=-73.789,"131"=-73.7743,"132"=-73.7781,"133"=-73.9742,"134"=-73.8272,"135"=-73.8107,"136"=-73.902,"137"=-73.9801,"138"=-73.874,"139"=-73.7448,"140"=-73.9602,"141"=-73.9602,"142"=-73.9845,"143"=-73.9845,"144"=-73.9949,"145"=-73.9507,"146"=-73.9374,"147"=-73.8916,"148"=-73.9843,"149"=-73.9492,"150"=-73.9389,"151"=-73.9697,"152"=-73.9558,"153"=-73.9103,"154"=-73.8906,"155"=-73.911,"156"=-74.1588,"157"=-73.9066,"158"=-74.0036,"159"=-73.9104,"160"=-73.8743,"161"=-73.984,"162"=-73.9668,"163"=-73.9851,"164"=-73.9788,"165"=-73.9654,"166"=-73.9624,"167"=-73.911,"168"=-73.9229,"169"=-73.9051,"170"=-73.9757,"171"=-73.8037,"172"=-74.0932,"173"=-73.8625,"174"=-73.8787,"175"=-73.7582,"176"=-74.116,"177"=-73.904329716,"178"=-73.9691,"179"=-73.9235,"180"=-73.8507,"181"=-73.9806,"182"=-73.8566,"183"=-73.8333,"184"=-73.8092,"185"=-73.864,"186"=-73.9893,"187"=-74.1255,"188"=-73.9507,"189"=-73.9668,"190"=-73.969,"191"=-73.7419,"192"=-73.8331,"193"=-73.9484,"194"=-73.9213,"195"=-74.0094,"196"=-73.8625,"197"=-73.8272,"198"=-73.9018,"199"=-73.88601,"200"=-73.9036,"201"=-73.8372,"202"=-73.951,"203"=-73.739,"204"=-74.1976,"205"=-73.7654,"206"=-74.0902,"207"=-73.8985,"208"=-73.8331,"209"=-74.0035,"210"=-73.9536,"211"=-74.003,"212"=-73.8684,"213"=-73.8507,"214"=-74.0885,"215"=-73.7919,"216"=-73.8507,"217"=-73.951996192,"218"=-73.7684,"219"=-73.7684,"220"=-73.9154,"221"=-74.0776,"222"=-73.8802,"223"=-73.9037,"224"=-73.9778,"225"=-73.932,"226"=-73.9196,"227"=-74.012383,"228"=-74.012383,"229"=-73.9668,"230"=-73.9851,"231"=-74.0028,"232"=-73.9892,"233"=-73.968,"234"=-73.9911,"235"=-73.9154,"236"=-73.9566,"237"=-73.9566,"238"=-73.9566,"239"=-73.9566,"240"=-73.8877,"241"=-73.894,"242"=-73.8707,"243"=-73.9394,"244"=-73.9394,"245"=-74.1093,"246"=-74.003783,"247"=-73.9228,"248"=-73.8816,"249"=-74.0036,"250"=-73.8507,"251"=-74.1318,"252"=-73.8096,"253"=-73.8404,"254"=-73.8566,"255"=-73.9571,"256"=-73.9571,"257"=-73.9757,"258"=-73.8566,"259"=-73.8507,"260"=-73.9036,"261"=-74.0131,"262"=-73.9492,"263"=-73.9492,"264"=0,"265"=0)


NYC_18_05_f$DOLat<- sapply(NYC_18_05_f$DOLocationID,switch,"1"=40.706268,"2"=40.603992,"3"=40.862305,"4"=40.725102,"5"=40.5568,"6"=40.60499758,"7"=40.7644,"8"=40.7792,"9"=40.7541,"10"=40.6738,"11"=40.6045,"12"=40.7033,"13"=40.7116,"14"=40.6262,"15"=40.7922,"16"=40.7586,"17"=40.6872,"18"=40.8701,"19"=40.732,"20"=40.8523,"21"=40.6113,"22"=40.603299,"23"=40.6073,"24"=40.7989,"25"=40.6849,"26"=40.6323,"27"=40.5867,"28"=40.7128,"29"=40.5781,"30"=40.6158,"31"=40.853829918,"32"=40.8506558,"33"=40.696,"34"=40.7020737,"35"=40.6631,"36"=40.6944,"37"=40.6944,"38"=40.6922,"39"=40.6402,"40"=40.6795,"41"=40.8116,"42"=40.8116,"43"=40.7829,"44"=40.5083,"45"=40.7158,"46"=40.8468,"47"=40.84,"48"=40.7638,"49"=40.6894,"50"=40.7638,"51"=40.8739,"52"=40.6865,"53"=40.7864,"54"=40.6874,"55"=40.5755,"56"=40.745,"57"=40.745,"58"=40.8392,"59"=40.84,"60"=40.84,"61"=40.6681,"62"=40.6681,"63"=40.6836,"64"=40.7687,"65"=40.696,"66"=40.7033,"67"=40.6215,"68"=40.7465,"69"=40.8284,"70"=40.7738,"71"=40.6437,"72"=40.6437,"73"=40.7526,"74"=40.8155,"75"=40.8116,"76"=40.6568,"77"=40.6568,"78"=40.8454,"79"=40.7265,"80"=40.7159,"81"=40.8833,"82"=40.738,"83"=40.7294,"84"=40.529,"85"=40.6493,"86"=40.5999,"87"=40.7075,"88"=40.7075,"89"=40.6409,"90"=40.7401,"91"=40.6268,"92"=40.7675,"93"=40.7397,"94"=40.8593,"95"=40.7181,"96"=40.6887278,"97"=40.6921,"98"=40.7335,"99"=40.5643,"100"=40.7547,"101"=40.7472,"102"=40.699,"103"=40.6895,"104"=40.6895,"105"=40.6895,"106"=40.6733,"107"=40.7368,"108"=40.591,"109"=40.5543,"110"=40.5488,"111"=40.6581,"112"=40.7245,"113"=40.7336,"114"=40.7336,"115"=40.6187,"116"=40.826,"117"=40.5927,"118"=40.6014,"119"=40.8385,"120"=40.8446,"121"=40.7336,"122"=40.7112,"123"=40.5999976,"124"=40.6571,"125"=40.7266,"126"=40.812,"127"=40.8677,"128"=40.8722,"129"=40.7557,"130"=40.7027,"131"=40.7179,"132"=40.6413,"133"=40.6376,"134"=40.7057,"135"=40.7385,"136"=40.872,"137"=40.7423,"138"=40.7769,"139"=40.6741,"140"=40.7662,"141"=40.7662,"142"=40.7738,"143"=40.7738,"144"=40.723,"145"=40.748,"146"=40.7489,"147"=40.8248,"148"=40.715,"149"=40.6056,"150"=40.5782,"151"=40.797,"152"=40.8169,"153"=40.8761,"154"=40.591,"155"=40.6101,"156"=40.6368,"157"=40.7294,"158"=40.7358,"159"=40.8245,"160"=40.7174,"161"=40.7549,"162"=40.754,"163"=40.765,"164"=40.7557,"165"=40.6191,"166"=40.809,"167"=40.8251,"168"=40.8091,"169"=40.8489,"170"=40.7479,"171"=40.7665,"172"=40.5715,"173"=40.7503,"174"=40.8771,"175"=40.7409,"176"=40.564,"177"=40.673830638,"178"=40.6169,"179"=40.7644,"180"=40.6794,"181"=40.6681,"182"=40.8383,"183"=40.8506,"184"=40.8655,"185"=40.8553,"186"=40.7428,"187"=40.6355,"188"=40.659,"189"=40.6774,"190"=40.6602,"191"=40.7157,"192"=40.7675,"193"=40.7567,"194"=40.7932,"195"=40.6773,"196"=40.7256,"197"=40.6958,"198"=40.7044,"199"=40.793128,"200"=40.8943,"201"=40.5798,"202"=40.7605,"203"=40.6584,"204"=40.5434,"205"=40.6894,"206"=40.6404,"207"=40.7647,"208"=40.8349,"209"=40.7071,"210"=40.5976,"211"=40.7233,"212"=40.8251,"213"=40.8177,"214"=40.5907,"215"=40.6809,"216"=40.6794,"217"=40.708497166,"218"=40.6626,"219"=40.6626,"220"=40.8812,"221"=40.6265,"222"=40.649,"223"=40.7745,"224"=40.7317,"225"=40.6824,"226"=40.7433,"227"=40.645531,"228"=40.645531,"229"=40.754,"230"=40.7589,"231"=40.7141,"232"=40.7149,"233"=40.7489,"234"=40.7359,"235"=40.8516,"236"=40.7736,"237"=40.7736,"238"=40.7736,"239"=40.7736,"240"=40.8963,"241"=40.884,"242"=40.8416,"243"=40.8417,"244"=40.8417,"245"=40.627,"246"=40.754661,"247"=40.8317,"248"=40.8431,"249"=40.7358,"250"=40.8275,"251"=40.6212,"252"=40.792,"253"=40.7607,"254"=40.8777,"255"=40.7081,"256"=40.7081,"257"=40.6539,"258"=40.6901,"259"=40.8965,"260"=40.7512,"261"=40.7118,"262"=40.7762,"263"=40.7762,"264"=0,"265"=0)
NYC_18_05_f$DOLong<- sapply(NYC_18_05_f$DOLocationID,switch,"1"=-74.176811,"2"=-73.835411,"3"=-73.84317,"4"=-73.979583,"5"=-74.1739,"6"=-74.05749977,"7"=-73.9235,"8"=-73.923,"9"=-73.786,"10"=-73.786,"11"=-74.0043,"12"=-74.017,"13"=-74.0158,"14"=-74.0329,"15"=-73.7761,"16"=-73.7654,"17"=-73.9418,"18"=-73.8857,"19"=-73.7184,"20"=-73.886,"21"=-73.9977,"22"=-74.001975,"23"=-74.0961,"24"=-73.9698,"25"=-73.9845,"26"=-73.9889,"27"=-73.8115,"28"=-73.7993,"29"=-73.9597,"30"=-73.8213,"31"=-73.872663176,"32"=-73.8665241,"33"=-73.9933,"34"=-73.9708292,"35"=-73.9095,"36"=-73.9213,"37"=-73.9213,"38"=-73.7331,"39"=-73.9061,"40"=-73.9992,"41"=-73.9465,"42"=-73.9465,"43"=-73.9654,"44"=-74.2355,"45"=-73.997,"46"=-73.7875,"47"=-73.9036,"48"=-73.9918,"49"=-73.9639,"50"=-73.9918,"51"=-73.8294,"52"=-73.9962,"53"=-73.839,"54"=-74.0021,"55"=-73.9707,"56"=-73.8643,"57"=-73.8643,"58"=-73.8197,"59"=-73.8953,"60"=-73.8953,"61"=-73.9448,"62"=-73.9448,"63"=-73.8801,"64"=-73.7471,"65"=-73.9845,"66"=-73.9881,"67"=-74.0096,"68"=-74.0014,"69"=-73.9169,"70"=-73.8713,"71"=-73.9301,"72"=-73.9301,"73"=-73.8096,"74"=-73.9556,"75"=-73.9465,"76"=-73.8831,"77"=-73.8831,"78"=-73.891,"79"=-73.9815,"80"=-73.933,"81"=-73.8272,"82"=-73.8801,"83"=-73.9066,"84"=-74.1976,"85"=-73.958,"86"=-73.7448,"87"=-74.0113,"88"=-74.0113,"89"=-73.9624,"90"=-73.9903,"91"=-73.933,"92"=-73.8331,"93"=-73.8408,"94"=-73.8985,"95"=-73.8448,"96"=-73.8862997,"97"=-73.9742,"98"=-73.7801,"99"=-74.1863,"100"=-73.9916,"101"=-73.7118,"102"=-73.8804,"103"=-74.0449,"104"=-74.0449,"105"=-74.0449,"106"=-73.9903,"107"=-73.9845,"108"=-73.9771,"109"=-74.1563,"110"=-74.1269,"111"=-73.9948,"112"=-73.9419,"113"=-74.0027,"114"=-74.0027,"115"=-74.0935,"116"=-73.9496,"117"=-73.7978,"118"=-74.1034,"119"=-73.9272,"120"=-73.933,"121"=-73.8124,"122"=-73.7625,"123"=-73.9499962,"124"=-73.843,"125"=-74.0075,"126"=-73.8801,"127"=-73.9212,"128"=-73.9256,"129"=-73.8831,"130"=-73.789,"131"=-73.7743,"132"=-73.7781,"133"=-73.9742,"134"=-73.8272,"135"=-73.8107,"136"=-73.902,"137"=-73.9801,"138"=-73.874,"139"=-73.7448,"140"=-73.9602,"141"=-73.9602,"142"=-73.9845,"143"=-73.9845,"144"=-73.9949,"145"=-73.9507,"146"=-73.9374,"147"=-73.8916,"148"=-73.9843,"149"=-73.9492,"150"=-73.9389,"151"=-73.9697,"152"=-73.9558,"153"=-73.9103,"154"=-73.8906,"155"=-73.911,"156"=-74.1588,"157"=-73.9066,"158"=-74.0036,"159"=-73.9104,"160"=-73.8743,"161"=-73.984,"162"=-73.9668,"163"=-73.9851,"164"=-73.9788,"165"=-73.9654,"166"=-73.9624,"167"=-73.911,"168"=-73.9229,"169"=-73.9051,"170"=-73.9757,"171"=-73.8037,"172"=-74.0932,"173"=-73.8625,"174"=-73.8787,"175"=-73.7582,"176"=-74.116,"177"=-73.904329716,"178"=-73.9691,"179"=-73.9235,"180"=-73.8507,"181"=-73.9806,"182"=-73.8566,"183"=-73.8333,"184"=-73.8092,"185"=-73.864,"186"=-73.9893,"187"=-74.1255,"188"=-73.9507,"189"=-73.9668,"190"=-73.969,"191"=-73.7419,"192"=-73.8331,"193"=-73.9484,"194"=-73.9213,"195"=-74.0094,"196"=-73.8625,"197"=-73.8272,"198"=-73.9018,"199"=-73.88601,"200"=-73.9036,"201"=-73.8372,"202"=-73.951,"203"=-73.739,"204"=-74.1976,"205"=-73.7654,"206"=-74.0902,"207"=-73.8985,"208"=-73.8331,"209"=-74.0035,"210"=-73.9536,"211"=-74.003,"212"=-73.8684,"213"=-73.8507,"214"=-74.0885,"215"=-73.7919,"216"=-73.8507,"217"=-73.951996192,"218"=-73.7684,"219"=-73.7684,"220"=-73.9154,"221"=-74.0776,"222"=-73.8802,"223"=-73.9037,"224"=-73.9778,"225"=-73.932,"226"=-73.9196,"227"=-74.012383,"228"=-74.012383,"229"=-73.9668,"230"=-73.9851,"231"=-74.0028,"232"=-73.9892,"233"=-73.968,"234"=-73.9911,"235"=-73.9154,"236"=-73.9566,"237"=-73.9566,"238"=-73.9566,"239"=-73.9566,"240"=-73.8877,"241"=-73.894,"242"=-73.8707,"243"=-73.9394,"244"=-73.9394,"245"=-74.1093,"246"=-74.003783,"247"=-73.9228,"248"=-73.8816,"249"=-74.0036,"250"=-73.8507,"251"=-74.1318,"252"=-73.8096,"253"=-73.8404,"254"=-73.8566,"255"=-73.9571,"256"=-73.9571,"257"=-73.9757,"258"=-73.8566,"259"=-73.8507,"260"=-73.9036,"261"=-74.0131,"262"=-73.9492,"263"=-73.9492,"264"=0,"265"=0)
head(NYC_18_05_f)

NYC_18_04_f$PULat<- sapply(NYC_18_04_f$PULocationID,switch,"1"=40.706268,"2"=40.603992,"3"=40.862305,"4"=40.725102,"5"=40.5568,"6"=40.60499758,"7"=40.7644,"8"=40.7792,"9"=40.7541,"10"=40.6738,"11"=40.6045,"12"=40.7033,"13"=40.7116,"14"=40.6262,"15"=40.7922,"16"=40.7586,"17"=40.6872,"18"=40.8701,"19"=40.732,"20"=40.8523,"21"=40.6113,"22"=40.603299,"23"=40.6073,"24"=40.7989,"25"=40.6849,"26"=40.6323,"27"=40.5867,"28"=40.7128,"29"=40.5781,"30"=40.6158,"31"=40.853829918,"32"=40.8506558,"33"=40.696,"34"=40.7020737,"35"=40.6631,"36"=40.6944,"37"=40.6944,"38"=40.6922,"39"=40.6402,"40"=40.6795,"41"=40.8116,"42"=40.8116,"43"=40.7829,"44"=40.5083,"45"=40.7158,"46"=40.8468,"47"=40.84,"48"=40.7638,"49"=40.6894,"50"=40.7638,"51"=40.8739,"52"=40.6865,"53"=40.7864,"54"=40.6874,"55"=40.5755,"56"=40.745,"57"=40.745,"58"=40.8392,"59"=40.84,"60"=40.84,"61"=40.6681,"62"=40.6681,"63"=40.6836,"64"=40.7687,"65"=40.696,"66"=40.7033,"67"=40.6215,"68"=40.7465,"69"=40.8284,"70"=40.7738,"71"=40.6437,"72"=40.6437,"73"=40.7526,"74"=40.8155,"75"=40.8116,"76"=40.6568,"77"=40.6568,"78"=40.8454,"79"=40.7265,"80"=40.7159,"81"=40.8833,"82"=40.738,"83"=40.7294,"84"=40.529,"85"=40.6493,"86"=40.5999,"87"=40.7075,"88"=40.7075,"89"=40.6409,"90"=40.7401,"91"=40.6268,"92"=40.7675,"93"=40.7397,"94"=40.8593,"95"=40.7181,"96"=40.6887278,"97"=40.6921,"98"=40.7335,"99"=40.5643,"100"=40.7547,"101"=40.7472,"102"=40.699,"103"=40.6895,"104"=40.6895,"105"=40.6895,"106"=40.6733,"107"=40.7368,"108"=40.591,"109"=40.5543,"110"=40.5488,"111"=40.6581,"112"=40.7245,"113"=40.7336,"114"=40.7336,"115"=40.6187,"116"=40.826,"117"=40.5927,"118"=40.6014,"119"=40.8385,"120"=40.8446,"121"=40.7336,"122"=40.7112,"123"=40.5999976,"124"=40.6571,"125"=40.7266,"126"=40.812,"127"=40.8677,"128"=40.8722,"129"=40.7557,"130"=40.7027,"131"=40.7179,"132"=40.6413,"133"=40.6376,"134"=40.7057,"135"=40.7385,"136"=40.872,"137"=40.7423,"138"=40.7769,"139"=40.6741,"140"=40.7662,"141"=40.7662,"142"=40.7738,"143"=40.7738,"144"=40.723,"145"=40.748,"146"=40.7489,"147"=40.8248,"148"=40.715,"149"=40.6056,"150"=40.5782,"151"=40.797,"152"=40.8169,"153"=40.8761,"154"=40.591,"155"=40.6101,"156"=40.6368,"157"=40.7294,"158"=40.7358,"159"=40.8245,"160"=40.7174,"161"=40.7549,"162"=40.754,"163"=40.765,"164"=40.7557,"165"=40.6191,"166"=40.809,"167"=40.8251,"168"=40.8091,"169"=40.8489,"170"=40.7479,"171"=40.7665,"172"=40.5715,"173"=40.7503,"174"=40.8771,"175"=40.7409,"176"=40.564,"177"=40.673830638,"178"=40.6169,"179"=40.7644,"180"=40.6794,"181"=40.6681,"182"=40.8383,"183"=40.8506,"184"=40.8655,"185"=40.8553,"186"=40.7428,"187"=40.6355,"188"=40.659,"189"=40.6774,"190"=40.6602,"191"=40.7157,"192"=40.7675,"193"=40.7567,"194"=40.7932,"195"=40.6773,"196"=40.7256,"197"=40.6958,"198"=40.7044,"199"=40.793128,"200"=40.8943,"201"=40.5798,"202"=40.7605,"203"=40.6584,"204"=40.5434,"205"=40.6894,"206"=40.6404,"207"=40.7647,"208"=40.8349,"209"=40.7071,"210"=40.5976,"211"=40.7233,"212"=40.8251,"213"=40.8177,"214"=40.5907,"215"=40.6809,"216"=40.6794,"217"=40.708497166,"218"=40.6626,"219"=40.6626,"220"=40.8812,"221"=40.6265,"222"=40.649,"223"=40.7745,"224"=40.7317,"225"=40.6824,"226"=40.7433,"227"=40.645531,"228"=40.645531,"229"=40.754,"230"=40.7589,"231"=40.7141,"232"=40.7149,"233"=40.7489,"234"=40.7359,"235"=40.8516,"236"=40.7736,"237"=40.7736,"238"=40.7736,"239"=40.7736,"240"=40.8963,"241"=40.884,"242"=40.8416,"243"=40.8417,"244"=40.8417,"245"=40.627,"246"=40.754661,"247"=40.8317,"248"=40.8431,"249"=40.7358,"250"=40.8275,"251"=40.6212,"252"=40.792,"253"=40.7607,"254"=40.8777,"255"=40.7081,"256"=40.7081,"257"=40.6539,"258"=40.6901,"259"=40.8965,"260"=40.7512,"261"=40.7118,"262"=40.7762,"263"=40.7762,"264"=0,"265"=0)
NYC_18_04_f$PULong<- sapply(NYC_18_04_f$PULocationID,switch,"1"=-74.176811,"2"=-73.835411,"3"=-73.84317,"4"=-73.979583,"5"=-74.1739,"6"=-74.05749977,"7"=-73.9235,"8"=-73.923,"9"=-73.786,"10"=-73.786,"11"=-74.0043,"12"=-74.017,"13"=-74.0158,"14"=-74.0329,"15"=-73.7761,"16"=-73.7654,"17"=-73.9418,"18"=-73.8857,"19"=-73.7184,"20"=-73.886,"21"=-73.9977,"22"=-74.001975,"23"=-74.0961,"24"=-73.9698,"25"=-73.9845,"26"=-73.9889,"27"=-73.8115,"28"=-73.7993,"29"=-73.9597,"30"=-73.8213,"31"=-73.872663176,"32"=-73.8665241,"33"=-73.9933,"34"=-73.9708292,"35"=-73.9095,"36"=-73.9213,"37"=-73.9213,"38"=-73.7331,"39"=-73.9061,"40"=-73.9992,"41"=-73.9465,"42"=-73.9465,"43"=-73.9654,"44"=-74.2355,"45"=-73.997,"46"=-73.7875,"47"=-73.9036,"48"=-73.9918,"49"=-73.9639,"50"=-73.9918,"51"=-73.8294,"52"=-73.9962,"53"=-73.839,"54"=-74.0021,"55"=-73.9707,"56"=-73.8643,"57"=-73.8643,"58"=-73.8197,"59"=-73.8953,"60"=-73.8953,"61"=-73.9448,"62"=-73.9448,"63"=-73.8801,"64"=-73.7471,"65"=-73.9845,"66"=-73.9881,"67"=-74.0096,"68"=-74.0014,"69"=-73.9169,"70"=-73.8713,"71"=-73.9301,"72"=-73.9301,"73"=-73.8096,"74"=-73.9556,"75"=-73.9465,"76"=-73.8831,"77"=-73.8831,"78"=-73.891,"79"=-73.9815,"80"=-73.933,"81"=-73.8272,"82"=-73.8801,"83"=-73.9066,"84"=-74.1976,"85"=-73.958,"86"=-73.7448,"87"=-74.0113,"88"=-74.0113,"89"=-73.9624,"90"=-73.9903,"91"=-73.933,"92"=-73.8331,"93"=-73.8408,"94"=-73.8985,"95"=-73.8448,"96"=-73.8862997,"97"=-73.9742,"98"=-73.7801,"99"=-74.1863,"100"=-73.9916,"101"=-73.7118,"102"=-73.8804,"103"=-74.0449,"104"=-74.0449,"105"=-74.0449,"106"=-73.9903,"107"=-73.9845,"108"=-73.9771,"109"=-74.1563,"110"=-74.1269,"111"=-73.9948,"112"=-73.9419,"113"=-74.0027,"114"=-74.0027,"115"=-74.0935,"116"=-73.9496,"117"=-73.7978,"118"=-74.1034,"119"=-73.9272,"120"=-73.933,"121"=-73.8124,"122"=-73.7625,"123"=-73.9499962,"124"=-73.843,"125"=-74.0075,"126"=-73.8801,"127"=-73.9212,"128"=-73.9256,"129"=-73.8831,"130"=-73.789,"131"=-73.7743,"132"=-73.7781,"133"=-73.9742,"134"=-73.8272,"135"=-73.8107,"136"=-73.902,"137"=-73.9801,"138"=-73.874,"139"=-73.7448,"140"=-73.9602,"141"=-73.9602,"142"=-73.9845,"143"=-73.9845,"144"=-73.9949,"145"=-73.9507,"146"=-73.9374,"147"=-73.8916,"148"=-73.9843,"149"=-73.9492,"150"=-73.9389,"151"=-73.9697,"152"=-73.9558,"153"=-73.9103,"154"=-73.8906,"155"=-73.911,"156"=-74.1588,"157"=-73.9066,"158"=-74.0036,"159"=-73.9104,"160"=-73.8743,"161"=-73.984,"162"=-73.9668,"163"=-73.9851,"164"=-73.9788,"165"=-73.9654,"166"=-73.9624,"167"=-73.911,"168"=-73.9229,"169"=-73.9051,"170"=-73.9757,"171"=-73.8037,"172"=-74.0932,"173"=-73.8625,"174"=-73.8787,"175"=-73.7582,"176"=-74.116,"177"=-73.904329716,"178"=-73.9691,"179"=-73.9235,"180"=-73.8507,"181"=-73.9806,"182"=-73.8566,"183"=-73.8333,"184"=-73.8092,"185"=-73.864,"186"=-73.9893,"187"=-74.1255,"188"=-73.9507,"189"=-73.9668,"190"=-73.969,"191"=-73.7419,"192"=-73.8331,"193"=-73.9484,"194"=-73.9213,"195"=-74.0094,"196"=-73.8625,"197"=-73.8272,"198"=-73.9018,"199"=-73.88601,"200"=-73.9036,"201"=-73.8372,"202"=-73.951,"203"=-73.739,"204"=-74.1976,"205"=-73.7654,"206"=-74.0902,"207"=-73.8985,"208"=-73.8331,"209"=-74.0035,"210"=-73.9536,"211"=-74.003,"212"=-73.8684,"213"=-73.8507,"214"=-74.0885,"215"=-73.7919,"216"=-73.8507,"217"=-73.951996192,"218"=-73.7684,"219"=-73.7684,"220"=-73.9154,"221"=-74.0776,"222"=-73.8802,"223"=-73.9037,"224"=-73.9778,"225"=-73.932,"226"=-73.9196,"227"=-74.012383,"228"=-74.012383,"229"=-73.9668,"230"=-73.9851,"231"=-74.0028,"232"=-73.9892,"233"=-73.968,"234"=-73.9911,"235"=-73.9154,"236"=-73.9566,"237"=-73.9566,"238"=-73.9566,"239"=-73.9566,"240"=-73.8877,"241"=-73.894,"242"=-73.8707,"243"=-73.9394,"244"=-73.9394,"245"=-74.1093,"246"=-74.003783,"247"=-73.9228,"248"=-73.8816,"249"=-74.0036,"250"=-73.8507,"251"=-74.1318,"252"=-73.8096,"253"=-73.8404,"254"=-73.8566,"255"=-73.9571,"256"=-73.9571,"257"=-73.9757,"258"=-73.8566,"259"=-73.8507,"260"=-73.9036,"261"=-74.0131,"262"=-73.9492,"263"=-73.9492,"264"=0,"265"=0)

NYC_18_04_f$DOLat<- sapply(NYC_18_04_f$DOLocationID,switch,"1"=40.706268,"2"=40.603992,"3"=40.862305,"4"=40.725102,"5"=40.5568,"6"=40.60499758,"7"=40.7644,"8"=40.7792,"9"=40.7541,"10"=40.6738,"11"=40.6045,"12"=40.7033,"13"=40.7116,"14"=40.6262,"15"=40.7922,"16"=40.7586,"17"=40.6872,"18"=40.8701,"19"=40.732,"20"=40.8523,"21"=40.6113,"22"=40.603299,"23"=40.6073,"24"=40.7989,"25"=40.6849,"26"=40.6323,"27"=40.5867,"28"=40.7128,"29"=40.5781,"30"=40.6158,"31"=40.853829918,"32"=40.8506558,"33"=40.696,"34"=40.7020737,"35"=40.6631,"36"=40.6944,"37"=40.6944,"38"=40.6922,"39"=40.6402,"40"=40.6795,"41"=40.8116,"42"=40.8116,"43"=40.7829,"44"=40.5083,"45"=40.7158,"46"=40.8468,"47"=40.84,"48"=40.7638,"49"=40.6894,"50"=40.7638,"51"=40.8739,"52"=40.6865,"53"=40.7864,"54"=40.6874,"55"=40.5755,"56"=40.745,"57"=40.745,"58"=40.8392,"59"=40.84,"60"=40.84,"61"=40.6681,"62"=40.6681,"63"=40.6836,"64"=40.7687,"65"=40.696,"66"=40.7033,"67"=40.6215,"68"=40.7465,"69"=40.8284,"70"=40.7738,"71"=40.6437,"72"=40.6437,"73"=40.7526,"74"=40.8155,"75"=40.8116,"76"=40.6568,"77"=40.6568,"78"=40.8454,"79"=40.7265,"80"=40.7159,"81"=40.8833,"82"=40.738,"83"=40.7294,"84"=40.529,"85"=40.6493,"86"=40.5999,"87"=40.7075,"88"=40.7075,"89"=40.6409,"90"=40.7401,"91"=40.6268,"92"=40.7675,"93"=40.7397,"94"=40.8593,"95"=40.7181,"96"=40.6887278,"97"=40.6921,"98"=40.7335,"99"=40.5643,"100"=40.7547,"101"=40.7472,"102"=40.699,"103"=40.6895,"104"=40.6895,"105"=40.6895,"106"=40.6733,"107"=40.7368,"108"=40.591,"109"=40.5543,"110"=40.5488,"111"=40.6581,"112"=40.7245,"113"=40.7336,"114"=40.7336,"115"=40.6187,"116"=40.826,"117"=40.5927,"118"=40.6014,"119"=40.8385,"120"=40.8446,"121"=40.7336,"122"=40.7112,"123"=40.5999976,"124"=40.6571,"125"=40.7266,"126"=40.812,"127"=40.8677,"128"=40.8722,"129"=40.7557,"130"=40.7027,"131"=40.7179,"132"=40.6413,"133"=40.6376,"134"=40.7057,"135"=40.7385,"136"=40.872,"137"=40.7423,"138"=40.7769,"139"=40.6741,"140"=40.7662,"141"=40.7662,"142"=40.7738,"143"=40.7738,"144"=40.723,"145"=40.748,"146"=40.7489,"147"=40.8248,"148"=40.715,"149"=40.6056,"150"=40.5782,"151"=40.797,"152"=40.8169,"153"=40.8761,"154"=40.591,"155"=40.6101,"156"=40.6368,"157"=40.7294,"158"=40.7358,"159"=40.8245,"160"=40.7174,"161"=40.7549,"162"=40.754,"163"=40.765,"164"=40.7557,"165"=40.6191,"166"=40.809,"167"=40.8251,"168"=40.8091,"169"=40.8489,"170"=40.7479,"171"=40.7665,"172"=40.5715,"173"=40.7503,"174"=40.8771,"175"=40.7409,"176"=40.564,"177"=40.673830638,"178"=40.6169,"179"=40.7644,"180"=40.6794,"181"=40.6681,"182"=40.8383,"183"=40.8506,"184"=40.8655,"185"=40.8553,"186"=40.7428,"187"=40.6355,"188"=40.659,"189"=40.6774,"190"=40.6602,"191"=40.7157,"192"=40.7675,"193"=40.7567,"194"=40.7932,"195"=40.6773,"196"=40.7256,"197"=40.6958,"198"=40.7044,"199"=40.793128,"200"=40.8943,"201"=40.5798,"202"=40.7605,"203"=40.6584,"204"=40.5434,"205"=40.6894,"206"=40.6404,"207"=40.7647,"208"=40.8349,"209"=40.7071,"210"=40.5976,"211"=40.7233,"212"=40.8251,"213"=40.8177,"214"=40.5907,"215"=40.6809,"216"=40.6794,"217"=40.708497166,"218"=40.6626,"219"=40.6626,"220"=40.8812,"221"=40.6265,"222"=40.649,"223"=40.7745,"224"=40.7317,"225"=40.6824,"226"=40.7433,"227"=40.645531,"228"=40.645531,"229"=40.754,"230"=40.7589,"231"=40.7141,"232"=40.7149,"233"=40.7489,"234"=40.7359,"235"=40.8516,"236"=40.7736,"237"=40.7736,"238"=40.7736,"239"=40.7736,"240"=40.8963,"241"=40.884,"242"=40.8416,"243"=40.8417,"244"=40.8417,"245"=40.627,"246"=40.754661,"247"=40.8317,"248"=40.8431,"249"=40.7358,"250"=40.8275,"251"=40.6212,"252"=40.792,"253"=40.7607,"254"=40.8777,"255"=40.7081,"256"=40.7081,"257"=40.6539,"258"=40.6901,"259"=40.8965,"260"=40.7512,"261"=40.7118,"262"=40.7762,"263"=40.7762,"264"=0,"265"=0)
NYC_18_04_f$DOLong<- sapply(NYC_18_04_f$DOLocationID,switch,"1"=-74.176811,"2"=-73.835411,"3"=-73.84317,"4"=-73.979583,"5"=-74.1739,"6"=-74.05749977,"7"=-73.9235,"8"=-73.923,"9"=-73.786,"10"=-73.786,"11"=-74.0043,"12"=-74.017,"13"=-74.0158,"14"=-74.0329,"15"=-73.7761,"16"=-73.7654,"17"=-73.9418,"18"=-73.8857,"19"=-73.7184,"20"=-73.886,"21"=-73.9977,"22"=-74.001975,"23"=-74.0961,"24"=-73.9698,"25"=-73.9845,"26"=-73.9889,"27"=-73.8115,"28"=-73.7993,"29"=-73.9597,"30"=-73.8213,"31"=-73.872663176,"32"=-73.8665241,"33"=-73.9933,"34"=-73.9708292,"35"=-73.9095,"36"=-73.9213,"37"=-73.9213,"38"=-73.7331,"39"=-73.9061,"40"=-73.9992,"41"=-73.9465,"42"=-73.9465,"43"=-73.9654,"44"=-74.2355,"45"=-73.997,"46"=-73.7875,"47"=-73.9036,"48"=-73.9918,"49"=-73.9639,"50"=-73.9918,"51"=-73.8294,"52"=-73.9962,"53"=-73.839,"54"=-74.0021,"55"=-73.9707,"56"=-73.8643,"57"=-73.8643,"58"=-73.8197,"59"=-73.8953,"60"=-73.8953,"61"=-73.9448,"62"=-73.9448,"63"=-73.8801,"64"=-73.7471,"65"=-73.9845,"66"=-73.9881,"67"=-74.0096,"68"=-74.0014,"69"=-73.9169,"70"=-73.8713,"71"=-73.9301,"72"=-73.9301,"73"=-73.8096,"74"=-73.9556,"75"=-73.9465,"76"=-73.8831,"77"=-73.8831,"78"=-73.891,"79"=-73.9815,"80"=-73.933,"81"=-73.8272,"82"=-73.8801,"83"=-73.9066,"84"=-74.1976,"85"=-73.958,"86"=-73.7448,"87"=-74.0113,"88"=-74.0113,"89"=-73.9624,"90"=-73.9903,"91"=-73.933,"92"=-73.8331,"93"=-73.8408,"94"=-73.8985,"95"=-73.8448,"96"=-73.8862997,"97"=-73.9742,"98"=-73.7801,"99"=-74.1863,"100"=-73.9916,"101"=-73.7118,"102"=-73.8804,"103"=-74.0449,"104"=-74.0449,"105"=-74.0449,"106"=-73.9903,"107"=-73.9845,"108"=-73.9771,"109"=-74.1563,"110"=-74.1269,"111"=-73.9948,"112"=-73.9419,"113"=-74.0027,"114"=-74.0027,"115"=-74.0935,"116"=-73.9496,"117"=-73.7978,"118"=-74.1034,"119"=-73.9272,"120"=-73.933,"121"=-73.8124,"122"=-73.7625,"123"=-73.9499962,"124"=-73.843,"125"=-74.0075,"126"=-73.8801,"127"=-73.9212,"128"=-73.9256,"129"=-73.8831,"130"=-73.789,"131"=-73.7743,"132"=-73.7781,"133"=-73.9742,"134"=-73.8272,"135"=-73.8107,"136"=-73.902,"137"=-73.9801,"138"=-73.874,"139"=-73.7448,"140"=-73.9602,"141"=-73.9602,"142"=-73.9845,"143"=-73.9845,"144"=-73.9949,"145"=-73.9507,"146"=-73.9374,"147"=-73.8916,"148"=-73.9843,"149"=-73.9492,"150"=-73.9389,"151"=-73.9697,"152"=-73.9558,"153"=-73.9103,"154"=-73.8906,"155"=-73.911,"156"=-74.1588,"157"=-73.9066,"158"=-74.0036,"159"=-73.9104,"160"=-73.8743,"161"=-73.984,"162"=-73.9668,"163"=-73.9851,"164"=-73.9788,"165"=-73.9654,"166"=-73.9624,"167"=-73.911,"168"=-73.9229,"169"=-73.9051,"170"=-73.9757,"171"=-73.8037,"172"=-74.0932,"173"=-73.8625,"174"=-73.8787,"175"=-73.7582,"176"=-74.116,"177"=-73.904329716,"178"=-73.9691,"179"=-73.9235,"180"=-73.8507,"181"=-73.9806,"182"=-73.8566,"183"=-73.8333,"184"=-73.8092,"185"=-73.864,"186"=-73.9893,"187"=-74.1255,"188"=-73.9507,"189"=-73.9668,"190"=-73.969,"191"=-73.7419,"192"=-73.8331,"193"=-73.9484,"194"=-73.9213,"195"=-74.0094,"196"=-73.8625,"197"=-73.8272,"198"=-73.9018,"199"=-73.88601,"200"=-73.9036,"201"=-73.8372,"202"=-73.951,"203"=-73.739,"204"=-74.1976,"205"=-73.7654,"206"=-74.0902,"207"=-73.8985,"208"=-73.8331,"209"=-74.0035,"210"=-73.9536,"211"=-74.003,"212"=-73.8684,"213"=-73.8507,"214"=-74.0885,"215"=-73.7919,"216"=-73.8507,"217"=-73.951996192,"218"=-73.7684,"219"=-73.7684,"220"=-73.9154,"221"=-74.0776,"222"=-73.8802,"223"=-73.9037,"224"=-73.9778,"225"=-73.932,"226"=-73.9196,"227"=-74.012383,"228"=-74.012383,"229"=-73.9668,"230"=-73.9851,"231"=-74.0028,"232"=-73.9892,"233"=-73.968,"234"=-73.9911,"235"=-73.9154,"236"=-73.9566,"237"=-73.9566,"238"=-73.9566,"239"=-73.9566,"240"=-73.8877,"241"=-73.894,"242"=-73.8707,"243"=-73.9394,"244"=-73.9394,"245"=-74.1093,"246"=-74.003783,"247"=-73.9228,"248"=-73.8816,"249"=-74.0036,"250"=-73.8507,"251"=-74.1318,"252"=-73.8096,"253"=-73.8404,"254"=-73.8566,"255"=-73.9571,"256"=-73.9571,"257"=-73.9757,"258"=-73.8566,"259"=-73.8507,"260"=-73.9036,"261"=-74.0131,"262"=-73.9492,"263"=-73.9492,"264"=0,"265"=0)


str(NYC_18_04_f)
str(NYC_18_05_f)
str(NYC_18_06_f)


#we also need to know the duration of each trip as it would be one of the variable that impacts the variable.

NYC_18_04_f$Cab_duration <- difftime(NYC_18_04_f$tpep_dropoff_datetime, NYC_18_04_f$tpep_pickup_datetime, units = "mins")
head(NYC_18_04_f)

NYC_18_05_f$Cab_duration <- difftime(NYC_18_05_f$tpep_dropoff_datetime, NYC_18_05_f$tpep_pickup_datetime, units = "mins")
head(NYC_18_05_f)

NYC_18_06_f$Cab_duration <- difftime(NYC_18_06_f$tpep_dropoff_datetime, NYC_18_06_f$tpep_pickup_datetime, units = "mins")
head(NYC_18_06_f)


#Sampling. We have debated between sampling randomly or quota sampling to ensure the sample is representative 
# of the past 3months database. To ensure we are representing the data appropriately we need to make sure we 
#we understand the nature of each variable and proportion in each month. 

head(NYC_18_06_f)


#In order to mimic the same functioning as the main database we will be taking a proportion of Days since it will represent 
#the demand pattern of the large dataset. 

NYC_18_06_f$PULocationID <- as.numeric(NYC_18_06_f$PULocationID)
NYC_18_06_f$PULocationID <- as.numeric(NYC_18_06_f$DOLocationID)

as.data.frame(table(NYC_18_06_f$DayPU))
as.data.frame(table(NYC_18_05_f$PULocationID))
as.data.frame(table(NYC_18_04_f$PULocationID))

set.seed(100)
nrow(NYC_18_06_f)
training1 <- createDataPartition(y = NYC_18_06_f$PULocationID, p = 0.1, list = F) 
nrow(training1)
NYC_18_06_train <- NYC_18_06_f[training1,]
nrow(NYC_18_06_train)
training2 <- createDataPartition(y = NYC_18_05_f$PULocationID, p = 0.1, list = F) 
NYC_18_05_train <- NYC_18_05_f[training2,]

training3 <- createDataPartition(y = NYC_18_04_f$PULocationID, p = 0.1, list = F) 
NYC_18_04_train <- NYC_18_04_f[training3,]

set.seed(110)
test1 <- createDataPartition(y = NYC_18_06_f$PULocationID, p = 0.1, list = F) 
NYC_18_06_test <- NYC_18_06_f[test1,]

test2 <- createDataPartition(y = NYC_18_05_f$PULocationID, p = 0.1, list = F) 
NYC_18_05_test <- NYC_18_05_f[test2,]

test3 <- createDataPartition(y = NYC_18_04_f$PULocationID, p = 0.1, list = F) 
NYC_18_04_test <- NYC_18_04_f[test3,]

rm (NYC_18_04_f)
rm (NYC_18_05_f)
rm (NYC_18_06_f)
rm (test1)
rm (test2)
rm (test3)
rm (training1)
rm (training2)
rm (training3)
rm(a)

?rbind

Trainingdb04_06 <- rbind (NYC_18_04_train,NYC_18_05_train,NYC_18_06_train)
str(Trainingdb04_06)
Testdb04_06 <- rbind (NYC_18_04_test,NYC_18_05_test,NYC_18_06_test)
rm(NYC_18_04_test,NYC_18_05_test, NYC_18_06_test, NYC_18_04_train, NYC_18_05_train, NYC_18_06_train)

set.seed(111)
training1.1 <- createDataPartition(y = Trainingdb04_06$PULocationID, p = 0.1, list = F) 
Trainingdb04_06f <- Trainingdb04_06[training1.1,]

test1.1 <- createDataPartition(y = Testdb04_06$PULocationID, p = 0.1, list = F) 
Testdb04_06f <- Testdb04_06[test1.1,]


rm (test1.1, training1.1, Trainingdb04_06, Testdb04_06)


NYCmap <- map_data("usa")
head(NYCmap)
head(Trainingdb04_06f)

Plot1<- ggplot() + 
  geom_polygon(data = NYCmap, aes(x=long, y = lat, group = group), color = "grey30", alpha = 0.6, size   = 0.3) +  
  coord_fixed(xlim = c(-74.7, -73.5), ylim = c(40.4,41.4)) + 
  geom_point(data = Trainingdb04_06f, aes(x=PULong , y=PULat), color = "blue", size = 3) +
  geom_point(data = Trainingdb04_06f, aes(x=DOLong, y=DOLat), color = "yellow", size = 1) + 
  ggtitle("Taxi Pick ups (blue) and Drop offs (yellow)")

Plot1


#googleNYCmap <- get_map(location = "New York", maptype = "roadmap", zoom = 15, source="google")
#ggmap(googleNYCmap)

lat <- c(40.5774,40.9176)
long <- c(-74.15,-73.7004)
bbox <- make_bbox(long,lat,f=0.05)
b <- get_map(bbox,maptype="toner-lite",source="stamen")

map <- ggmap(b)

map
head(Trainingdb04_06f)



Plot2 <- map+geom_point(data=Trainingdb04_06f,aes(x=PULong,y=PULat, color=DayPU),size=.15) + 
  facet_wrap(~DayPU, nrow = 2) + 
  theme(legend.position="none")
Plot2

Plot3 <- map+geom_point(data=Trainingdb04_06f,aes(x=DOLong,y=DOLat, color=DayDO),size=.15) + 
  facet_wrap(~DayDO, nrow = 2) + 
  theme(legend.position="none")
Plot3



Plot4 <- map+geom_point(data=Trainingdb04_06f,aes(x=DOLong,y=DOLat, color=passenger_count),size= 1) + 
  facet_wrap(~DayDO, nrow = 2) +
  theme(legend.position=c(0.8,0.2))+
  labs(fill = "No of Passenger")+
  ggtitle("Passenger Count By Day", subtitle = "Geolocation")
  
Plot4

#Building Model

source("http://pcwww.liv.ac.uk/~william/R/crosstab.r")
head(Trainingdb04_06f)

Trainingdb04_06f$Month <-months(as.POSIXct(Trainingdb04_06f$tpep_pickup_datetime), abbreviate = T)

Volume_vendor <- table(Trainingdb04_06f$VendorID, Trainingdb04_06f$Month)
prop.table(Volume_vendor, 2)

#We would like to take out July an March data from the dataset. 

Trainingdb04_06f<- subset(Trainingdb04_06f, Month == "Apr"|Month == "Jun"|Month == "May")


aggregate(Trainingdb04_06f$total_amount, by=list(Category=Trainingdb04_06f$Month), FUN=sum)

p2<- ggplot(Trainingdb04_06f,aes(x=DayPU,y=total_amount, fill = DayPU)) + 
  stat_summary(fun.y=sum,geom="bar") +
  ggtitle("Revenue by Day")
p2


p2.1<- ggplot(Trainingdb04_06f,aes(x=DayPU,y=total_amount, fill = factor(passenger_count))) + 
  stat_summary(fun.y=sum,position="dodge", geom="bar") +
  ggtitle("Revenue by Day & Passanger Count")
p2.1

p2.2<- ggplot(Trainingdb04_06f,aes(x=DayPU,y=total_amount, fill = factor(payment_type))) + 
  stat_summary(fun.y=sum,position="dodge", geom="bar") +
  ggtitle("Revenue by Day & Payment Method")
p2.2

p3<-ggplot(Trainingdb04_06f,aes(x=factor(Trainingdb04_06f$Month),y=total_amount,fill=factor(VendorID))) +  
  stat_summary(fun.y=sum,position="dodge",geom="bar") +
  ggtitle("Revenue by Month", subtitle = "By Vendor")
p3

p4<-ggplot(Trainingdb04_06f,aes(x=factor(Trainingdb04_06f$DayPU),y=total_amount,fill=factor(VendorID))) +  
  stat_summary(fun.y=sum,position="dodge",geom="bar")+
  ggtitle("Revenue by Vendor", subtitle = "By Weekday")
p4


p5<-ggplot(Trainingdb04_06f,aes(x=factor(Trainingdb04_06f$DayPU),y=trip_distance,fill=factor(VendorID)))+  
  stat_summary(fun.y=mean,position="dodge",geom="bar")+
  ggtitle("Trip Distance BY Day")
p5


p6.1<-ggplot(Trainingdb04_06f,aes(x=factor(Trainingdb04_06f$DayPU),y=fare_amount,fill=factor(VendorID)))+  
  stat_summary(fun.y=mean,position="dodge",geom="bar")+
  ggtitle("Average Fare Amount")
p6.1

p6.2<-ggplot(Trainingdb04_06f,aes(x=factor(Trainingdb04_06f$DayPU),y=extra,fill=factor(VendorID)))+  
  stat_summary(fun.y=mean,position="dodge",geom="bar")+
  ggtitle("Average Extra Amount")
p6.2

p6.3<-ggplot(Trainingdb04_06f,aes(x=factor(Trainingdb04_06f$DayPU),y=tip_amount,fill=factor(VendorID)))+  
  stat_summary(fun.y=mean,position="dodge",geom="bar")+
  ggtitle("Average Tip")
p6.3

p6.4<-ggplot(Trainingdb04_06f,aes(x=factor(Trainingdb04_06f$DayPU),y=tolls_amount,fill=factor(VendorID)))+  
  stat_summary(fun.y=mean,position="dodge",geom="bar")+
  ggtitle("Average Toll")
p6.4


fare_amount<- mean(Trainingdb04_06f$fare_amount)
extra<- mean(Trainingdb04_06f$extra)
mta_tax<- mean(Trainingdb04_06f$mta_tax)
tip_amount<- mean(Trainingdb04_06f$tip_amount)
tolls_amount<- mean(Trainingdb04_06f$tolls_amount)
total_amount<- mean(Trainingdb04_06f$total_amount)


Avgcost_breakup <- data.frame(fare_amount, extra, mta_tax, tip_amount, tolls_amount)
Avgcost_breakup
prop.table(Avgcost_breakup)*100



#We would like to Combine PU Point and DO Point to be able to get frequency by pair

Trainingdb04_06f$Pair <- paste(Trainingdb04_06f$PULocationID, Trainingdb04_06f$DOLocationID, sep = ",")
str(Trainingdb04_06f)

#prop.table(Trainingdb04_06f$Pair)
Trainingdb04_06f$Pair<-as.factor(Trainingdb04_06f$Pair)
head(Trainingdb04_06f$Pair)

library(plyr)
a<-count(Trainingdb04_06f, 'Pair')
View(a)
a<- a[order(-a$freq),]
a$prop<- prop.table(a$freq)*100 

#Now we would be using the frequency of travel from each location by the day of the week. 

p6.5<-ggplot(Trainingdb04_06f,aes(x=factor(Pair),y=Pair, factor(VendorID)))+  
  stat_summary(fun.y=sum,position="dodge",geom="bar")+
  ggtitle("Freq")
p6.5


library(dplyr)

Trainingdb04_06f_500<- Trainingdb04_06f %>% 
  group_by(Pair) %>% 
  filter(n()>500) %>%
  as.data.frame


str(Trainingdb04_06f_500)

#We will be working with this database as we have taken on only these pair of PU and DO location where the frequency is above 
#500 in the last 3 months. Knowing this is the most common route for Newyorkers. 

##rm(Trainingdb04_06f)

head(Trainingdb04_06f_500)

b<-count(Trainingdb04_06f_500, Pair)
View(b)
b<- b[order(-b$n),]
b$prop<- prop.table(b$n)*100 



#googleNYCmap <- get_map(location = "New York", maptype = "roadmap", zoom = 15, source="google")
#ggmap(googleNYCmap)

lat <- c(40.5774,40.9176)
long <- c(-74.15,-73.7004)
bbox <- make_bbox(long,lat,f=0.05)
b <- get_map(bbox,maptype="toner-lite",source="stamen")

map <- ggmap(b)

map



Plot2.1 <- map+geom_point(data=Trainingdb04_06f_500,aes(x=PULong,y=PULat, color=DayPU),size=2) + 
  facet_wrap(~DayPU, nrow = 2) + 
  theme(legend.position="none")+
  ggtitle("Pick-up Points", subtitle = " >500 rides April'18 to Jun'18")
Plot2.1

Plot3.1 <- map+geom_point(data=Trainingdb04_06f_500,aes(x=DOLong,y=DOLat, color=DayDO),size=2) + 
  facet_wrap(~DayDO, nrow = 2) + 
  theme(legend.position="none")+
  ggtitle("Drop Points", subtitle = " >500 rides April'18 to Jun'18")
Plot3.1


Plot4.1 <- map+geom_point(data=Trainingdb04_06f_500,aes(x=PULong,y=PULat, color=passenger_count),size= 2) + 
  facet_wrap(~DayDO, nrow = 2) +
  theme(legend.position=c(0.8,0.2))+
  labs(fill = "No of Passenger")+
  ggtitle("Passenger Count By Day", subtitle = "Geolocation ABOVE 500 ride April'18 to Jun'18")
Plot4.1



Plot5.1 <- map+geom_point(data=Trainingdb04_06f_500,aes(x=PULong,y=PULat, color=VendorID),size= 2) + 
  facet_wrap(~DayDO, nrow = 2) +
  theme(legend.position=c(0.8,0.2))+
  labs(fill = "No of Passenger")+
  ggtitle("Passenger Count By Vendor ID", subtitle = "Geolocation ABOVE 500 ride April'18 to Jun'18")
Plot5.1

Plot6.1 <- map+geom_point(data=Trainingdb04_06f_500,aes(x=PULong,y=PULat, color=factor(VendorID)),size= 2) + 
  facet_wrap(~DayDO, nrow = 2) +
  theme(legend.position=c(0.8,0.2))+
  labs(fill = "No of Passenger")+
  ggtitle("Vendor Presence By Day", subtitle = "Geolocation ABOVE 500 ride April'18 to Jun'18")
Plot6.1

Plot7.1 <- map+geom_point(data=Trainingdb04_06f_500,aes(x=PULong,y=PULat,color = total_amount) , size= 3) + 
  facet_wrap(~DayDO, nrow = 2) +
  theme(legend.position=c(0.8,0.2))+
  ggtitle("Renenue By Day ", subtitle = "Geolocation ABOVE 500 ride April'18 to Jun'18")
Plot7.1

Plot8.1 <- map+geom_point(data=Trainingdb04_06f_500,aes(x=PULong,y=PULat,color = trip_distance) , size= 3) + 
  facet_wrap(~DayPU, nrow = 2) +
  theme(legend.position=c(0.8,0.2))+
  ggtitle("Distance By Day ", subtitle = "Pick-Up")
Plot8.1

Plot8.2 <- map+geom_point(data=Trainingdb04_06f_500,aes(x=DOLong,y=DOLat,color = trip_distance) , size= 3) + 
  facet_wrap(~DayPU, nrow = 2) +
  theme(legend.position=c(0.8,0.2))+
  ggtitle("Distance By Day ", subtitle = "Drop Location")
Plot8.2

Plot9.1 <- map+geom_point(data=Trainingdb04_06f_500,aes(x=DOLong,y=DOLat,color = tip_amount<2) , size= 3) + 
  theme(legend.position=c(0.99,1))+
  ggtitle("Tips ", subtitle = "Drop Location - Mean = $2")
Plot9.1


mean(Trainingdb04_06f_500$trip_distance)


#Heatmap 
library(RColorBrewer)

Trainingdb04_06f_500$PULocationID<- as.factor(Trainingdb04_06f_500$PULocationID)
Trainingdb04_06f_500$DOLocationID <- as.factor(Trainingdb04_06f_500$DOLocationID)

summary(Trainingdb04_06f_500$total_amount)

#rm(Plot10)

Plot10<- ggplot(Trainingdb04_06f_500, aes(x=factor(PULocationID), y=factor(DOLocationID), color = log(total_amount)))+
  geom_point()+
  xlab("Pick-location")+
  ylab("Drop Location")+
  scale_color_gradient(low="green", high="red")+
  ggtitle("Log Ride Fare by location")

Plot10

Trainingdb04_06f_500$PUhour <-hour(as.POSIXct(Trainingdb04_06f_500$tpep_pickup_datetime))
Trainingdb04_06f_500$DOhour <-hour(as.POSIXct(Trainingdb04_06f_500$tpep_dropoff_datetime))

summary(Trainingdb04_06f_500)

Plot11.1 <- map+geom_point(data=Trainingdb04_06f_500,aes(x=PULong,y=PULat,color = PUhour) , size= 3) + 
  theme(legend.position=c(0.8,0.2))+
  facet_wrap(~DayDO, nrow = 2) +
  scale_color_gradient(low="green", high="red")+
  ggtitle("Pick-up Hour ", subtitle = "By weekday")
Plot11.1


#Now we will attempt to see traffic from the most frequent pickup points in NYC. For this we will attempt graph theory

rm(Pickup, Droploc,nodes)

NYCnetwork <- Trainingdb04_06f %>%  
  group_by(PULocationID, DOLocationID) %>%
  summarise(weight = n()) %>% 
  ungroup()

summary(Trainingdb04_06f)
head(NYCnetwork)
nrow(NYCnetwork)

sum(NYCnetwork$weight)

NYCnetwork$PULat<- sapply(NYCnetwork$PULocationID,switch,"1"=40.706268,"2"=40.603992,"3"=40.862305,"4"=40.725102,"5"=40.5568,"6"=40.60499758,"7"=40.7644,"8"=40.7792,"9"=40.7541,"10"=40.6738,"11"=40.6045,"12"=40.7033,"13"=40.7116,"14"=40.6262,"15"=40.7922,"16"=40.7586,"17"=40.6872,"18"=40.8701,"19"=40.732,"20"=40.8523,"21"=40.6113,"22"=40.603299,"23"=40.6073,"24"=40.7989,"25"=40.6849,"26"=40.6323,"27"=40.5867,"28"=40.7128,"29"=40.5781,"30"=40.6158,"31"=40.853829918,"32"=40.8506558,"33"=40.696,"34"=40.7020737,"35"=40.6631,"36"=40.6944,"37"=40.6944,"38"=40.6922,"39"=40.6402,"40"=40.6795,"41"=40.8116,"42"=40.8116,"43"=40.7829,"44"=40.5083,"45"=40.7158,"46"=40.8468,"47"=40.84,"48"=40.7638,"49"=40.6894,"50"=40.7638,"51"=40.8739,"52"=40.6865,"53"=40.7864,"54"=40.6874,"55"=40.5755,"56"=40.745,"57"=40.745,"58"=40.8392,"59"=40.84,"60"=40.84,"61"=40.6681,"62"=40.6681,"63"=40.6836,"64"=40.7687,"65"=40.696,"66"=40.7033,"67"=40.6215,"68"=40.7465,"69"=40.8284,"70"=40.7738,"71"=40.6437,"72"=40.6437,"73"=40.7526,"74"=40.8155,"75"=40.8116,"76"=40.6568,"77"=40.6568,"78"=40.8454,"79"=40.7265,"80"=40.7159,"81"=40.8833,"82"=40.738,"83"=40.7294,"84"=40.529,"85"=40.6493,"86"=40.5999,"87"=40.7075,"88"=40.7075,"89"=40.6409,"90"=40.7401,"91"=40.6268,"92"=40.7675,"93"=40.7397,"94"=40.8593,"95"=40.7181,"96"=40.6887278,"97"=40.6921,"98"=40.7335,"99"=40.5643,"100"=40.7547,"101"=40.7472,"102"=40.699,"103"=40.6895,"104"=40.6895,"105"=40.6895,"106"=40.6733,"107"=40.7368,"108"=40.591,"109"=40.5543,"110"=40.5488,"111"=40.6581,"112"=40.7245,"113"=40.7336,"114"=40.7336,"115"=40.6187,"116"=40.826,"117"=40.5927,"118"=40.6014,"119"=40.8385,"120"=40.8446,"121"=40.7336,"122"=40.7112,"123"=40.5999976,"124"=40.6571,"125"=40.7266,"126"=40.812,"127"=40.8677,"128"=40.8722,"129"=40.7557,"130"=40.7027,"131"=40.7179,"132"=40.6413,"133"=40.6376,"134"=40.7057,"135"=40.7385,"136"=40.872,"137"=40.7423,"138"=40.7769,"139"=40.6741,"140"=40.7662,"141"=40.7662,"142"=40.7738,"143"=40.7738,"144"=40.723,"145"=40.748,"146"=40.7489,"147"=40.8248,"148"=40.715,"149"=40.6056,"150"=40.5782,"151"=40.797,"152"=40.8169,"153"=40.8761,"154"=40.591,"155"=40.6101,"156"=40.6368,"157"=40.7294,"158"=40.7358,"159"=40.8245,"160"=40.7174,"161"=40.7549,"162"=40.754,"163"=40.765,"164"=40.7557,"165"=40.6191,"166"=40.809,"167"=40.8251,"168"=40.8091,"169"=40.8489,"170"=40.7479,"171"=40.7665,"172"=40.5715,"173"=40.7503,"174"=40.8771,"175"=40.7409,"176"=40.564,"177"=40.673830638,"178"=40.6169,"179"=40.7644,"180"=40.6794,"181"=40.6681,"182"=40.8383,"183"=40.8506,"184"=40.8655,"185"=40.8553,"186"=40.7428,"187"=40.6355,"188"=40.659,"189"=40.6774,"190"=40.6602,"191"=40.7157,"192"=40.7675,"193"=40.7567,"194"=40.7932,"195"=40.6773,"196"=40.7256,"197"=40.6958,"198"=40.7044,"199"=40.793128,"200"=40.8943,"201"=40.5798,"202"=40.7605,"203"=40.6584,"204"=40.5434,"205"=40.6894,"206"=40.6404,"207"=40.7647,"208"=40.8349,"209"=40.7071,"210"=40.5976,"211"=40.7233,"212"=40.8251,"213"=40.8177,"214"=40.5907,"215"=40.6809,"216"=40.6794,"217"=40.708497166,"218"=40.6626,"219"=40.6626,"220"=40.8812,"221"=40.6265,"222"=40.649,"223"=40.7745,"224"=40.7317,"225"=40.6824,"226"=40.7433,"227"=40.645531,"228"=40.645531,"229"=40.754,"230"=40.7589,"231"=40.7141,"232"=40.7149,"233"=40.7489,"234"=40.7359,"235"=40.8516,"236"=40.7736,"237"=40.7736,"238"=40.7736,"239"=40.7736,"240"=40.8963,"241"=40.884,"242"=40.8416,"243"=40.8417,"244"=40.8417,"245"=40.627,"246"=40.754661,"247"=40.8317,"248"=40.8431,"249"=40.7358,"250"=40.8275,"251"=40.6212,"252"=40.792,"253"=40.7607,"254"=40.8777,"255"=40.7081,"256"=40.7081,"257"=40.6539,"258"=40.6901,"259"=40.8965,"260"=40.7512,"261"=40.7118,"262"=40.7762,"263"=40.7762,"264"=0,"265"=0)
NYCnetwork$PULong<- sapply(NYCnetwork$PULocationID,switch,"1"=-74.176811,"2"=-73.835411,"3"=-73.84317,"4"=-73.979583,"5"=-74.1739,"6"=-74.05749977,"7"=-73.9235,"8"=-73.923,"9"=-73.786,"10"=-73.786,"11"=-74.0043,"12"=-74.017,"13"=-74.0158,"14"=-74.0329,"15"=-73.7761,"16"=-73.7654,"17"=-73.9418,"18"=-73.8857,"19"=-73.7184,"20"=-73.886,"21"=-73.9977,"22"=-74.001975,"23"=-74.0961,"24"=-73.9698,"25"=-73.9845,"26"=-73.9889,"27"=-73.8115,"28"=-73.7993,"29"=-73.9597,"30"=-73.8213,"31"=-73.872663176,"32"=-73.8665241,"33"=-73.9933,"34"=-73.9708292,"35"=-73.9095,"36"=-73.9213,"37"=-73.9213,"38"=-73.7331,"39"=-73.9061,"40"=-73.9992,"41"=-73.9465,"42"=-73.9465,"43"=-73.9654,"44"=-74.2355,"45"=-73.997,"46"=-73.7875,"47"=-73.9036,"48"=-73.9918,"49"=-73.9639,"50"=-73.9918,"51"=-73.8294,"52"=-73.9962,"53"=-73.839,"54"=-74.0021,"55"=-73.9707,"56"=-73.8643,"57"=-73.8643,"58"=-73.8197,"59"=-73.8953,"60"=-73.8953,"61"=-73.9448,"62"=-73.9448,"63"=-73.8801,"64"=-73.7471,"65"=-73.9845,"66"=-73.9881,"67"=-74.0096,"68"=-74.0014,"69"=-73.9169,"70"=-73.8713,"71"=-73.9301,"72"=-73.9301,"73"=-73.8096,"74"=-73.9556,"75"=-73.9465,"76"=-73.8831,"77"=-73.8831,"78"=-73.891,"79"=-73.9815,"80"=-73.933,"81"=-73.8272,"82"=-73.8801,"83"=-73.9066,"84"=-74.1976,"85"=-73.958,"86"=-73.7448,"87"=-74.0113,"88"=-74.0113,"89"=-73.9624,"90"=-73.9903,"91"=-73.933,"92"=-73.8331,"93"=-73.8408,"94"=-73.8985,"95"=-73.8448,"96"=-73.8862997,"97"=-73.9742,"98"=-73.7801,"99"=-74.1863,"100"=-73.9916,"101"=-73.7118,"102"=-73.8804,"103"=-74.0449,"104"=-74.0449,"105"=-74.0449,"106"=-73.9903,"107"=-73.9845,"108"=-73.9771,"109"=-74.1563,"110"=-74.1269,"111"=-73.9948,"112"=-73.9419,"113"=-74.0027,"114"=-74.0027,"115"=-74.0935,"116"=-73.9496,"117"=-73.7978,"118"=-74.1034,"119"=-73.9272,"120"=-73.933,"121"=-73.8124,"122"=-73.7625,"123"=-73.9499962,"124"=-73.843,"125"=-74.0075,"126"=-73.8801,"127"=-73.9212,"128"=-73.9256,"129"=-73.8831,"130"=-73.789,"131"=-73.7743,"132"=-73.7781,"133"=-73.9742,"134"=-73.8272,"135"=-73.8107,"136"=-73.902,"137"=-73.9801,"138"=-73.874,"139"=-73.7448,"140"=-73.9602,"141"=-73.9602,"142"=-73.9845,"143"=-73.9845,"144"=-73.9949,"145"=-73.9507,"146"=-73.9374,"147"=-73.8916,"148"=-73.9843,"149"=-73.9492,"150"=-73.9389,"151"=-73.9697,"152"=-73.9558,"153"=-73.9103,"154"=-73.8906,"155"=-73.911,"156"=-74.1588,"157"=-73.9066,"158"=-74.0036,"159"=-73.9104,"160"=-73.8743,"161"=-73.984,"162"=-73.9668,"163"=-73.9851,"164"=-73.9788,"165"=-73.9654,"166"=-73.9624,"167"=-73.911,"168"=-73.9229,"169"=-73.9051,"170"=-73.9757,"171"=-73.8037,"172"=-74.0932,"173"=-73.8625,"174"=-73.8787,"175"=-73.7582,"176"=-74.116,"177"=-73.904329716,"178"=-73.9691,"179"=-73.9235,"180"=-73.8507,"181"=-73.9806,"182"=-73.8566,"183"=-73.8333,"184"=-73.8092,"185"=-73.864,"186"=-73.9893,"187"=-74.1255,"188"=-73.9507,"189"=-73.9668,"190"=-73.969,"191"=-73.7419,"192"=-73.8331,"193"=-73.9484,"194"=-73.9213,"195"=-74.0094,"196"=-73.8625,"197"=-73.8272,"198"=-73.9018,"199"=-73.88601,"200"=-73.9036,"201"=-73.8372,"202"=-73.951,"203"=-73.739,"204"=-74.1976,"205"=-73.7654,"206"=-74.0902,"207"=-73.8985,"208"=-73.8331,"209"=-74.0035,"210"=-73.9536,"211"=-74.003,"212"=-73.8684,"213"=-73.8507,"214"=-74.0885,"215"=-73.7919,"216"=-73.8507,"217"=-73.951996192,"218"=-73.7684,"219"=-73.7684,"220"=-73.9154,"221"=-74.0776,"222"=-73.8802,"223"=-73.9037,"224"=-73.9778,"225"=-73.932,"226"=-73.9196,"227"=-74.012383,"228"=-74.012383,"229"=-73.9668,"230"=-73.9851,"231"=-74.0028,"232"=-73.9892,"233"=-73.968,"234"=-73.9911,"235"=-73.9154,"236"=-73.9566,"237"=-73.9566,"238"=-73.9566,"239"=-73.9566,"240"=-73.8877,"241"=-73.894,"242"=-73.8707,"243"=-73.9394,"244"=-73.9394,"245"=-74.1093,"246"=-74.003783,"247"=-73.9228,"248"=-73.8816,"249"=-74.0036,"250"=-73.8507,"251"=-74.1318,"252"=-73.8096,"253"=-73.8404,"254"=-73.8566,"255"=-73.9571,"256"=-73.9571,"257"=-73.9757,"258"=-73.8566,"259"=-73.8507,"260"=-73.9036,"261"=-74.0131,"262"=-73.9492,"263"=-73.9492,"264"=0,"265"=0)

NYCnetwork$DOLat<- sapply(NYCnetwork$DOLocationID,switch,"1"=40.706268,"2"=40.603992,"3"=40.862305,"4"=40.725102,"5"=40.5568,"6"=40.60499758,"7"=40.7644,"8"=40.7792,"9"=40.7541,"10"=40.6738,"11"=40.6045,"12"=40.7033,"13"=40.7116,"14"=40.6262,"15"=40.7922,"16"=40.7586,"17"=40.6872,"18"=40.8701,"19"=40.732,"20"=40.8523,"21"=40.6113,"22"=40.603299,"23"=40.6073,"24"=40.7989,"25"=40.6849,"26"=40.6323,"27"=40.5867,"28"=40.7128,"29"=40.5781,"30"=40.6158,"31"=40.853829918,"32"=40.8506558,"33"=40.696,"34"=40.7020737,"35"=40.6631,"36"=40.6944,"37"=40.6944,"38"=40.6922,"39"=40.6402,"40"=40.6795,"41"=40.8116,"42"=40.8116,"43"=40.7829,"44"=40.5083,"45"=40.7158,"46"=40.8468,"47"=40.84,"48"=40.7638,"49"=40.6894,"50"=40.7638,"51"=40.8739,"52"=40.6865,"53"=40.7864,"54"=40.6874,"55"=40.5755,"56"=40.745,"57"=40.745,"58"=40.8392,"59"=40.84,"60"=40.84,"61"=40.6681,"62"=40.6681,"63"=40.6836,"64"=40.7687,"65"=40.696,"66"=40.7033,"67"=40.6215,"68"=40.7465,"69"=40.8284,"70"=40.7738,"71"=40.6437,"72"=40.6437,"73"=40.7526,"74"=40.8155,"75"=40.8116,"76"=40.6568,"77"=40.6568,"78"=40.8454,"79"=40.7265,"80"=40.7159,"81"=40.8833,"82"=40.738,"83"=40.7294,"84"=40.529,"85"=40.6493,"86"=40.5999,"87"=40.7075,"88"=40.7075,"89"=40.6409,"90"=40.7401,"91"=40.6268,"92"=40.7675,"93"=40.7397,"94"=40.8593,"95"=40.7181,"96"=40.6887278,"97"=40.6921,"98"=40.7335,"99"=40.5643,"100"=40.7547,"101"=40.7472,"102"=40.699,"103"=40.6895,"104"=40.6895,"105"=40.6895,"106"=40.6733,"107"=40.7368,"108"=40.591,"109"=40.5543,"110"=40.5488,"111"=40.6581,"112"=40.7245,"113"=40.7336,"114"=40.7336,"115"=40.6187,"116"=40.826,"117"=40.5927,"118"=40.6014,"119"=40.8385,"120"=40.8446,"121"=40.7336,"122"=40.7112,"123"=40.5999976,"124"=40.6571,"125"=40.7266,"126"=40.812,"127"=40.8677,"128"=40.8722,"129"=40.7557,"130"=40.7027,"131"=40.7179,"132"=40.6413,"133"=40.6376,"134"=40.7057,"135"=40.7385,"136"=40.872,"137"=40.7423,"138"=40.7769,"139"=40.6741,"140"=40.7662,"141"=40.7662,"142"=40.7738,"143"=40.7738,"144"=40.723,"145"=40.748,"146"=40.7489,"147"=40.8248,"148"=40.715,"149"=40.6056,"150"=40.5782,"151"=40.797,"152"=40.8169,"153"=40.8761,"154"=40.591,"155"=40.6101,"156"=40.6368,"157"=40.7294,"158"=40.7358,"159"=40.8245,"160"=40.7174,"161"=40.7549,"162"=40.754,"163"=40.765,"164"=40.7557,"165"=40.6191,"166"=40.809,"167"=40.8251,"168"=40.8091,"169"=40.8489,"170"=40.7479,"171"=40.7665,"172"=40.5715,"173"=40.7503,"174"=40.8771,"175"=40.7409,"176"=40.564,"177"=40.673830638,"178"=40.6169,"179"=40.7644,"180"=40.6794,"181"=40.6681,"182"=40.8383,"183"=40.8506,"184"=40.8655,"185"=40.8553,"186"=40.7428,"187"=40.6355,"188"=40.659,"189"=40.6774,"190"=40.6602,"191"=40.7157,"192"=40.7675,"193"=40.7567,"194"=40.7932,"195"=40.6773,"196"=40.7256,"197"=40.6958,"198"=40.7044,"199"=40.793128,"200"=40.8943,"201"=40.5798,"202"=40.7605,"203"=40.6584,"204"=40.5434,"205"=40.6894,"206"=40.6404,"207"=40.7647,"208"=40.8349,"209"=40.7071,"210"=40.5976,"211"=40.7233,"212"=40.8251,"213"=40.8177,"214"=40.5907,"215"=40.6809,"216"=40.6794,"217"=40.708497166,"218"=40.6626,"219"=40.6626,"220"=40.8812,"221"=40.6265,"222"=40.649,"223"=40.7745,"224"=40.7317,"225"=40.6824,"226"=40.7433,"227"=40.645531,"228"=40.645531,"229"=40.754,"230"=40.7589,"231"=40.7141,"232"=40.7149,"233"=40.7489,"234"=40.7359,"235"=40.8516,"236"=40.7736,"237"=40.7736,"238"=40.7736,"239"=40.7736,"240"=40.8963,"241"=40.884,"242"=40.8416,"243"=40.8417,"244"=40.8417,"245"=40.627,"246"=40.754661,"247"=40.8317,"248"=40.8431,"249"=40.7358,"250"=40.8275,"251"=40.6212,"252"=40.792,"253"=40.7607,"254"=40.8777,"255"=40.7081,"256"=40.7081,"257"=40.6539,"258"=40.6901,"259"=40.8965,"260"=40.7512,"261"=40.7118,"262"=40.7762,"263"=40.7762,"264"=0,"265"=0)
NYCnetwork$DOLong<- sapply(NYCnetwork$DOLocationID,switch,"1"=-74.176811,"2"=-73.835411,"3"=-73.84317,"4"=-73.979583,"5"=-74.1739,"6"=-74.05749977,"7"=-73.9235,"8"=-73.923,"9"=-73.786,"10"=-73.786,"11"=-74.0043,"12"=-74.017,"13"=-74.0158,"14"=-74.0329,"15"=-73.7761,"16"=-73.7654,"17"=-73.9418,"18"=-73.8857,"19"=-73.7184,"20"=-73.886,"21"=-73.9977,"22"=-74.001975,"23"=-74.0961,"24"=-73.9698,"25"=-73.9845,"26"=-73.9889,"27"=-73.8115,"28"=-73.7993,"29"=-73.9597,"30"=-73.8213,"31"=-73.872663176,"32"=-73.8665241,"33"=-73.9933,"34"=-73.9708292,"35"=-73.9095,"36"=-73.9213,"37"=-73.9213,"38"=-73.7331,"39"=-73.9061,"40"=-73.9992,"41"=-73.9465,"42"=-73.9465,"43"=-73.9654,"44"=-74.2355,"45"=-73.997,"46"=-73.7875,"47"=-73.9036,"48"=-73.9918,"49"=-73.9639,"50"=-73.9918,"51"=-73.8294,"52"=-73.9962,"53"=-73.839,"54"=-74.0021,"55"=-73.9707,"56"=-73.8643,"57"=-73.8643,"58"=-73.8197,"59"=-73.8953,"60"=-73.8953,"61"=-73.9448,"62"=-73.9448,"63"=-73.8801,"64"=-73.7471,"65"=-73.9845,"66"=-73.9881,"67"=-74.0096,"68"=-74.0014,"69"=-73.9169,"70"=-73.8713,"71"=-73.9301,"72"=-73.9301,"73"=-73.8096,"74"=-73.9556,"75"=-73.9465,"76"=-73.8831,"77"=-73.8831,"78"=-73.891,"79"=-73.9815,"80"=-73.933,"81"=-73.8272,"82"=-73.8801,"83"=-73.9066,"84"=-74.1976,"85"=-73.958,"86"=-73.7448,"87"=-74.0113,"88"=-74.0113,"89"=-73.9624,"90"=-73.9903,"91"=-73.933,"92"=-73.8331,"93"=-73.8408,"94"=-73.8985,"95"=-73.8448,"96"=-73.8862997,"97"=-73.9742,"98"=-73.7801,"99"=-74.1863,"100"=-73.9916,"101"=-73.7118,"102"=-73.8804,"103"=-74.0449,"104"=-74.0449,"105"=-74.0449,"106"=-73.9903,"107"=-73.9845,"108"=-73.9771,"109"=-74.1563,"110"=-74.1269,"111"=-73.9948,"112"=-73.9419,"113"=-74.0027,"114"=-74.0027,"115"=-74.0935,"116"=-73.9496,"117"=-73.7978,"118"=-74.1034,"119"=-73.9272,"120"=-73.933,"121"=-73.8124,"122"=-73.7625,"123"=-73.9499962,"124"=-73.843,"125"=-74.0075,"126"=-73.8801,"127"=-73.9212,"128"=-73.9256,"129"=-73.8831,"130"=-73.789,"131"=-73.7743,"132"=-73.7781,"133"=-73.9742,"134"=-73.8272,"135"=-73.8107,"136"=-73.902,"137"=-73.9801,"138"=-73.874,"139"=-73.7448,"140"=-73.9602,"141"=-73.9602,"142"=-73.9845,"143"=-73.9845,"144"=-73.9949,"145"=-73.9507,"146"=-73.9374,"147"=-73.8916,"148"=-73.9843,"149"=-73.9492,"150"=-73.9389,"151"=-73.9697,"152"=-73.9558,"153"=-73.9103,"154"=-73.8906,"155"=-73.911,"156"=-74.1588,"157"=-73.9066,"158"=-74.0036,"159"=-73.9104,"160"=-73.8743,"161"=-73.984,"162"=-73.9668,"163"=-73.9851,"164"=-73.9788,"165"=-73.9654,"166"=-73.9624,"167"=-73.911,"168"=-73.9229,"169"=-73.9051,"170"=-73.9757,"171"=-73.8037,"172"=-74.0932,"173"=-73.8625,"174"=-73.8787,"175"=-73.7582,"176"=-74.116,"177"=-73.904329716,"178"=-73.9691,"179"=-73.9235,"180"=-73.8507,"181"=-73.9806,"182"=-73.8566,"183"=-73.8333,"184"=-73.8092,"185"=-73.864,"186"=-73.9893,"187"=-74.1255,"188"=-73.9507,"189"=-73.9668,"190"=-73.969,"191"=-73.7419,"192"=-73.8331,"193"=-73.9484,"194"=-73.9213,"195"=-74.0094,"196"=-73.8625,"197"=-73.8272,"198"=-73.9018,"199"=-73.88601,"200"=-73.9036,"201"=-73.8372,"202"=-73.951,"203"=-73.739,"204"=-74.1976,"205"=-73.7654,"206"=-74.0902,"207"=-73.8985,"208"=-73.8331,"209"=-74.0035,"210"=-73.9536,"211"=-74.003,"212"=-73.8684,"213"=-73.8507,"214"=-74.0885,"215"=-73.7919,"216"=-73.8507,"217"=-73.951996192,"218"=-73.7684,"219"=-73.7684,"220"=-73.9154,"221"=-74.0776,"222"=-73.8802,"223"=-73.9037,"224"=-73.9778,"225"=-73.932,"226"=-73.9196,"227"=-74.012383,"228"=-74.012383,"229"=-73.9668,"230"=-73.9851,"231"=-74.0028,"232"=-73.9892,"233"=-73.968,"234"=-73.9911,"235"=-73.9154,"236"=-73.9566,"237"=-73.9566,"238"=-73.9566,"239"=-73.9566,"240"=-73.8877,"241"=-73.894,"242"=-73.8707,"243"=-73.9394,"244"=-73.9394,"245"=-74.1093,"246"=-74.003783,"247"=-73.9228,"248"=-73.8816,"249"=-74.0036,"250"=-73.8507,"251"=-74.1318,"252"=-73.8096,"253"=-73.8404,"254"=-73.8566,"255"=-73.9571,"256"=-73.9571,"257"=-73.9757,"258"=-73.8566,"259"=-73.8507,"260"=-73.9036,"261"=-74.0131,"262"=-73.9492,"263"=-73.9492,"264"=0,"265"=0)

NYCnetwork$bin <- cut(NYCnetwork$weight, 4)
NYCnetwork <- select(NYCnetwork, -bin)

NYCnetwork$bin <- cut(NYCnetwork$weight, 3, include.lowest=TRUE, labels=c("Low", "Med", "High"))
NYCnetwork$bin <- as.factor(NYCnetwork$bin)


Plot10 <- map+ geom_point(data=NYCnetwork,aes(x=PULong,y=PULat),  color = NYCnetwork$weight, size= 4, shape = 20 ) +
  theme(legend.position=c(0.8,0.2))+ ggtitle("Frequency of Travel", subtitle = "by Taxi Zones")

write.csv(NYCnetwork, file = "NYCnetwork.csv")

Plot10 



ggplot(NYCnetwork, aes(x=PULocationID, y=DOLocationID, color = bin)) + 
  geom_point()+ geom_density_2d() +ggtitle("Network Density")+
  scale_x_continuous("Pickup Location ID", breaks = NYCnetwork$DOLocationID)+
  theme(text = element_text(size=20), axis.text.x = element_text(size=rel(0.4),angle=90, hjust=1)) 
  

Plot5




#Creating Network Graph. 
NYCnetwork$PULocationID<-as.character(NYCnetwork$PULocationID)
NYCnetwork$DOLocationID<-as.character(NYCnetwork$DOLocationID)

net<- graph.data.frame(NYCnetwork, directed = T)
tkplot(net)

#Densely Connected Nodes 
net<- graph.data.frame(NYCnetwork, directed = F)
community <- cluster_edge_betweenness(net)
l <- layout_with_fr(net)
plot(community, net, layout = l, margin = -0.31, vertex.size = 8, vertex.label.cex = 0.7, 
     edge.arrow.size=0.0005, edge.size = 0.05, main = "Network Clusters")


#Network Analysis. - Clustering Zones. 

#nodes<- Trainingdb04_06f
NYCnetwork$PULocationID<-as.character(NYCnetwork$PULocationID)
NYCnetwork$DOLocationID<-as.character(NYCnetwork$DOLocationID)
NYCnetwork<- as.matrix(NYCnetwork)
NYCnetworkg = graph.edgelist(NYCnetwork[,1:2])
E(NYCnetworkg)$weight=as.numeric(NYCnetwork[,3])

str(NYCnetworkg)

plot(NYCnetworkg,layout=layout.fruchterman.reingold,edge.width=E(NYCnetworkg)$weight)

NYCnetworkadj=get.adjacency(NYCnetworkg,attr='weight')
str(NYCnetworkadj)

install.packages("Matrix")
library(Matrix)


str()summary(NYCnetworkg)

NYCnetworkg

NYCnetworkg
E(NYCnetworkg)
V(NYCnetworkg)
E(NYCnetworkg)$weight

plot(NYCnetworkg, edge.arrow.size=.4,vertex.label.cex=0.35, main = "IGraph Network")
as_edgelist(NYCnetworkg, names=T)


#NYCnetworkg2 <- graph_from_incidence_matrix(NYCnetworkg)
#NYCnetworkg.bp <- bipartite.projection(NYCnetworkg2)


tkid <- tkplot(NYCnetworkg) #tkid is the id of the tkplot that will open
l <- tkplot.getcoords(tkid) # grab the coordinates from tkplot
tk_close(tkid, window.close = T)
plot(NYCnetworkg, layout=l, edge.arrow.size=.4,vertex.label.cex=0.35, main = "TK Graph Network") 

NYCnetworkm <- get.adjacency(NYCnetworkg, attr="weight", sparse=F)
colnames(NYCnetworkm) <- V(NYCnetworkg)$name
rownames(NYCnetworkm) <- V(NYCnetworkg)$name
palf <- colorRampPalette(c("green", "dark orange"))

head(NYCnetworkm)


par(mfrow=c(1,2))
heatmap(NYCnetworkm, Rowv = NA, col = palf(100),
        scale="none", main = "Network Heatmap - Row HCluster")

heatmap(NYCnetworkm, Colv = NA, col = palf(100),
        scale="none", main = "Network Heatmap - Column HCluster")


mean_distance(NYCnetworkg, directed=F)
mean_distance(NYCnetworkg, directed=T)


cocitation(NYCnetworkg)
NYCnetworkg.sym <- as.undirected(NYCnetworkg, mode= "collapse",
                         edge.attr.comb=list(weight="sum", "ignore"))

cliques(NYCnetworkg.sym) # list of cliques
sapply(cliques(NYCnetworkg.sym), length) # clique sizes
largest_cliques(NYCnetworkg.sym) # cliques with max number of nodes
vcol <- rep("grey80", vcount(NYCnetworkg.sym))
vcol[unlist(largest_cliques(NYCnetworkg.sym))] <- "gold"
plot(as.undirected(NYCnetworkg.sym), vertex.label=V(NYCnetworkg.sym)$name, vertex.color=vcol)


#Creating H-Cluster. 
NYCnetworkg_ceb <- cluster_edge_betweenness(as.undirected(NYCnetworkg))
dendPlot(NYCnetworkg_ceb, mode="hclust")
length(NYCnetworkg_ceb) ## number of communities
membership(NYCnetworkg_ceb) # community membership for each node

install.packages("dendextend");
library(dendextend)
fc<-fastgreedy.community(as.undirected(NYCnetworkg))
dendPlot(fc, hang =0.0000000000000000000000000000008, rect = 5)

#Marcov Chain. 
View(NYCnetwork)


NYCnetwork$prop<- (NYCnetwork[[weight]]/sum(NYCnetwork[[weight]])*100)
NYCnetwork <- select(NYCnetwork, -weight)
NYCnetwork$PULocationID<-as.character(NYCnetwork$PULocationID)
NYCnetwork$DOLocationID<-as.character(NYCnetwork$DOLocationID)
NYCnetwork<- as.matrix(NYCnetwork)
NYCnetworkg = graph.edgelist(NYCnetwork[,1:2])
E(NYCnetworkg)$weight=as.numeric(NYCnetwork[,3])
NYCnetwork_MC<-get.adjacency(NYCnetworkg)
View(NYCnetwork_MC)
NYCnetwork_MC<-as.matrix(NYCnetwork_MC)

summary(NYCnetwork_MC)
myFit<-markovchainFit(data=NYCnetwork_MC,confidencelevel = .9,method = "mle")
?markovchainFit

createSequenceMatrix(NYCnetwork_MC)


#Decision Tree:
install.packages("FSelector")
library(FSelector)

Trainingdb04_06f_500$PUmonth <-months(as.POSIXct(Trainingdb04_06f_500$tpep_pickup_datetime))
Trainingdb04_06f_500$PUdate <-day(as.POSIXct(Trainingdb04_06f_500$tpep_pickup_datetime))

count(Trainingdb04_06f_500$PUmonth)

summary(Trainingdb04_06f)
summary(Trainingdb04_06f_500)

Trainingdb04_06f$Month <-months(as.POSIXct(Trainingdb04_06f$tpep_pickup_datetime), abbreviate = T)

Volume_vendor <- table(Trainingdb04_06f$VendorID, Trainingdb04_06f$Month)
prop.table(Volume_vendor, 2)

Trainingdb04_06f_500$Month <-months(as.POSIXct(Trainingdb04_06f_500$tpep_pickup_datetime), abbreviate = T)
Trainingdb04_06f_500$Date <-day(as.POSIXct(Trainingdb04_06f_500$tpep_pickup_datetime))

Volume_vendor2 <- table(Trainingdb04_06f_500$VendorID, Trainingdb04_06f_500$Month)
prop.table(Volume_vendor2, 2)


#We would like to take out July an March data from the dataset. 

Trainingdb04_06f_500<- subset(Trainingdb04_06f_500, Month == "Apr"|Month == "Jun"|Month == "May")


#Decision Tree:

install.packages("tree")
library(tree)
library(caret)
library(rpart)
library(party)


summary(Trainingdb04_06f_500)
rm(Testdb04_06f)

training.samples <- Trainingdb04_06f_500$total_amount %>%
  createDataPartition(p = 0.8, list = FALSE)
train.data  <- Trainingdb04_06f_500[training.samples, ]
test.data <- Trainingdb04_06f_500[-training.samples, ]


str(train.data)
library(dplyr)
train.data$VendorID<-as.factor(train.data$VendorID)
train.data$PULocationID<-as.factor(train.data$PULocationID)
train.data$DOLocationID<-as.factor(train.data$DOLocationID)
train.data <- train.data %>% select(VendorID, passenger_count, trip_distance,PULocationID,DOLocationID, fare_amount, tip_amount, tolls_amount, DayPU, Month,Date, total_amount)

DTmodel1<- train(total_amount~., train.data, method = "rpart", trControl = trainControl("cv", number = 10),tuneLength = 10)
plot(DTmodel1)
DTmodel1$bestTune
par(xpd = NA)
plot(DTmodel1$finalModel)
text(DTmodel1$finalModel, digits = 3)
predictions <- DTmodel1 %>% predict(test.data)
RMSE(predictions, test.data$total_amount)
